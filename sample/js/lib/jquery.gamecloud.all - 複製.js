"undefined"!==typeof dojo?dojo.provide("org.cometd"):(this.org=this.org||{},org.cometd={});org.cometd.JSON={};org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(){throw"Abstract";};org.cometd.Utils={};org.cometd.Utils.isString=function(a){return void 0===a||null===a?!1:"string"===typeof a||a instanceof String};org.cometd.Utils.isArray=function(a){return void 0===a||null===a?!1:a instanceof Array};org.cometd.Utils.inArray=function(a,j){for(var b=0;b<j.length;++b)if(a==j[b])return b;return-1};
org.cometd.Utils.setTimeout=function(a,j,b){return setTimeout(function(){try{j()}catch(b){a._debug("Exception invoking timed function",j,b)}},b)};
org.cometd.TransportRegistry=function(){var a=[],j={};this.getTransportTypes=function(){return a.slice(0)};this.findTransportTypes=function(b,e,k){for(var d=[],g=0;g<a.length;++g){var i=a[g];!0===j[i].accept(b,e,k)&&d.push(i)}return d};this.negotiateTransport=function(b,e,k,d){for(var g=0;g<a.length;++g)for(var i=a[g],c=0;c<b.length;++c)if(i==b[c]){var h=j[i];if(!0===h.accept(e,k,d))return h}return null};this.add=function(b,e,k){for(var d=!1,g=0;g<a.length;++g)if(a[g]==b){d=!0;break}d||("number"!==
typeof k?a.push(b):a.splice(k,0,b),j[b]=e);return!d};this.find=function(b){for(var e=0;e<a.length;++e)if(a[e]==b)return j[b];return null};this.remove=function(b){for(var e=0;e<a.length;++e)if(a[e]==b)return a.splice(e,1),e=j[b],delete j[b],e;return null};this.reset=function(){for(var b=0;b<a.length;++b)j[a[b]].reset()}};
org.cometd.Transport=function(){var a,j;this.registered=function(b,e){a=b;j=e};this.unregistered=function(){j=a=null};this._debug=function(){j._debug.apply(j,arguments)};this._mixin=function(){return j._mixin.apply(j,arguments)};this.getConfiguration=function(){return j.getConfiguration()};this.getAdvice=function(){return j.getAdvice()};this.setTimeout=function(b,a){return org.cometd.Utils.setTimeout(j,b,a)};this.convertToMessages=function(b){if(org.cometd.Utils.isString(b))try{return org.cometd.JSON.fromJSON(b)}catch(a){throw this._debug("Could not convert to JSON the following string",
'"'+b+'"'),a;}if(org.cometd.Utils.isArray(b))return b;if(void 0===b||null===b)return[];if(b instanceof Object)return[b];throw"Conversion Error "+b+", typeof "+typeof b;};this.accept=function(){throw"Abstract";};this.getType=function(){return a};this.send=function(){throw"Abstract";};this.reset=function(){this._debug("Transport",a,"reset")};this.abort=function(){this._debug("Transport",a,"aborted")};this.toString=function(){return this.getType()}};
org.cometd.Transport.derive=function(a){function j(){}j.prototype=a;return new j};
org.cometd.RequestTransport=function(){function a(b,a){this.transportSend(b,a);a.expired=!1;if(!b.sync){var d=this.getConfiguration().maxNetworkDelay,f=d;!0===a.metaConnect&&(f+=this.getAdvice().timeout);this._debug("Transport",this.getType(),"waiting at most",f,"ms for the response, maxNetworkDelay",d);var g=this;a.timeout=this.setTimeout(function(){a.expired=!0;a.xhr&&a.xhr.abort();var d="Request "+a.id+" of transport "+g.getType()+" exceeded "+f+" ms max network delay";g._debug(d);g.complete(a,
!1,a.metaConnect);b.onFailure(a.xhr,b.messages,"timeout",d)},f)}}function j(b){var h=++k,d={id:h,metaConnect:!1};g.length<this.getConfiguration().maxConnections-1?(g.push(d),a.call(this,b,d)):(this._debug("Transport",this.getType(),"queueing request",h,"envelope",b),i.push([b,d]))}var b=new org.cometd.Transport,e=org.cometd.Transport.derive(b),k=0,d=null,g=[],i=[];e.complete=function(b,a,e){if(e){b=b.id;this._debug("Transport",this.getType(),"metaConnect complete, request",b);if(null!==d&&d.id!==
b)throw"Longpoll request mismatch, completing request "+b;d=null}else if(e=org.cometd.Utils.inArray(b,g),0<=e&&g.splice(e,1),0<i.length){var e=i.shift(),f=e[0],l=e[1];this._debug("Transport dequeued request",l.id);if(a){if(this.getConfiguration().autoBatch)for(;0<i.length;)if(e=i[0],a=e[0],e=e[1],a.url===f.url&&a.sync===f.sync)i.shift(),f.messages=f.messages.concat(a.messages),this._debug("Coalesced",a.messages.length,"messages from request",e.id);else break;j.call(this,f);this._debug("Transport completed request",
b.id,f)}else{var q=this;this.setTimeout(function(){q.complete(l,!1,l.metaConnect);f.onFailure(l.xhr,f.messages,"error","Previous request failed")},0)}}};e.transportSend=function(){throw"Abstract";};e.transportSuccess=function(b,a,d){if(!a.expired)if(clearTimeout(a.timeout),this.complete(a,!0,a.metaConnect),d&&0<d.length)b.onSuccess(d);else b.onFailure(a.xhr,b.messages,"Empty HTTP response")};e.transportFailure=function(b,a,d,f){a.expired||(clearTimeout(a.timeout),this.complete(a,!1,a.metaConnect),
b.onFailure(a.xhr,b.messages,d,f))};e.send=function(b,h){if(h){if(null!==d)throw"Concurrent metaConnect requests not allowed, request id="+d.id+" not yet completed";var e=++k;this._debug("Transport",this.getType(),"metaConnect send, request",e,"envelope",b);e={id:e,metaConnect:!0};a.call(this,b,e);d=e}else j.call(this,b)};e.abort=function(){b.abort();for(var a=0;a<g.length;++a){var h=g[a];this._debug("Aborting request",h);h.xhr&&h.xhr.abort()}d&&(this._debug("Aborting metaConnect request",d),d.xhr&&
d.xhr.abort());this.reset()};e.reset=function(){b.reset();d=null;g=[];i=[]};return e};
org.cometd.LongPollingTransport=function(){var a=new org.cometd.RequestTransport,j=org.cometd.Transport.derive(a),b=!0;j.accept=function(a,k){return b||!k};j.xhrSend=function(){throw"Abstract";};j.transportSend=function(a,k){this._debug("Transport",this.getType(),"sending request",k.id,"envelope",a);var d=this;try{var g=!0;k.xhr=this.xhrSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(a.messages),onSuccess:function(c){d._debug("Transport",
d.getType(),"received response",c);var h=!1;try{var g=d.convertToMessages(c);0===g.length?(b=!1,d.transportFailure(a,k,"no response",null)):(h=!0,d.transportSuccess(a,k,g))}catch(f){d._debug(f),h||(b=!1,d.transportFailure(a,k,"bad response",f))}},onError:function(c,h){b=!1;g?d.setTimeout(function(){d.transportFailure(a,k,c,h)},0):d.transportFailure(a,k,c,h)}});g=!1}catch(i){b=!1,this.setTimeout(function(){d.transportFailure(a,k,"error",i)},0)}};j.reset=function(){a.reset();b=!0};return j};
org.cometd.CallbackPollingTransport=function(){var a=new org.cometd.RequestTransport,a=org.cometd.Transport.derive(a);a.accept=function(){return!0};a.jsonpSend=function(){throw"Abstract";};a.transportSend=function(a,b){for(var e=this,k=0,d=a.messages.length,g=[];0<d;){var i=org.cometd.JSON.toJSON(a.messages.slice(k,k+d)),i=a.url.length+encodeURI(i).length;if(2E3<i){if(1==d){var c="Bayeux message too big ("+i+" bytes, max is 2000) for transport "+this.getType();this.setTimeout(function(){e.transportFailure(a,
b,"error",c)},0);return}--d}else g.push(d),k+=d,d=a.messages.length-k}var h=a;if(1<g.length){k=0;d=g[0];this._debug("Transport",this.getType(),"split",a.messages.length,"messages into",g.join(" + "));h=this._mixin(!1,{},a);h.messages=a.messages.slice(k,d);h.onSuccess=a.onSuccess;h.onFailure=a.onFailure;for(i=1;i<g.length;++i){var t=this._mixin(!1,{},a),k=d,d=d+g[i];t.messages=a.messages.slice(k,d);t.onSuccess=a.onSuccess;t.onFailure=a.onFailure;this.send(t,b.metaConnect)}}this._debug("Transport",
this.getType(),"sending request",b.id,"envelope",h);try{var f=!0;this.jsonpSend({transport:this,url:h.url,sync:h.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(h.messages),onSuccess:function(a){var f=!1;try{var c=e.convertToMessages(a);0===c.length?e.transportFailure(h,b,"no response"):(f=!0,e.transportSuccess(h,b,c))}catch(d){e._debug(d),f||e.transportFailure(h,b,"bad response",d)}},onError:function(a,c){f?e.setTimeout(function(){e.transportFailure(h,b,a,c)},0):e.transportFailure(h,
b,a,c)}});f=!1}catch(l){this.setTimeout(function(){e.transportFailure(h,b,"error",l)},0)}};return a};
org.cometd.WebSocketTransport=function(){function a(a,b){try{var d=org.cometd.JSON.toJSON(a.messages);h.send(d);this._debug("Transport",this.getType(),"sent",a,"metaConnect =",b);var g=this.getConfiguration().maxNetworkDelay,e=g;b&&(e+=this.getAdvice().timeout);for(var d=[],k=0;k<a.messages.length;++k){var r=a.messages[k];if(r.id){d.push(r.id);var t=this;i[r.id]=this.setTimeout(function(){var b="Message "+r.id+" of transport "+t.getType()+" exceeded "+e+" ms max network delay";t._debug(b);delete i[r.id];
for(var d in c)if(c[d]===a){delete c[d];break}a.onFailure(h,a.messages,"timeout",b)},e)}}this._debug("Transport",this.getType(),"waiting at most",e," ms for messages",d,"maxNetworkDelay",g,", timeouts:",i)}catch(j){this.setTimeout(function(){a.onFailure(h,a.messages,"error",j)},0)}}var j=new org.cometd.Transport,b=org.cometd.Transport.derive(j),e,k=!0,d=!1,g=2,i={},c={},h,t;b.registered=function(a,b){j.registered(a,b);e=b};b.accept=function(){return k&&!!window.WebSocket&&!0===e.websocketEnabled};
b.onMessage=function(a){this._debug("Transport",this.getType(),"received websocket message",a);if(1===g){for(var a=this.convertToMessages(a.data),b=[],d=0;d<a.length;++d){var e=a[d];if((/^\/meta\//.test(e.channel)||void 0===e.data)&&e.id){b.push(e.id);var m=i[e.id];m&&(clearTimeout(m),delete i[e.id],this._debug("Transport",this.getType(),"removed timeout for message",e.id,", timeouts",i))}"/meta/disconnect"===e.channel&&e.successful&&h.close()}d=!1;for(e=0;e<b.length;++e){var k=b[e],r;for(r in c){var m=
r.split(","),j=org.cometd.Utils.inArray(k,m);if(0<=j){d=!0;m.splice(j,1);k=c[r];delete c[r];0<m.length&&(c[m.join(",")]=k);break}}}d&&this._debug("Transport",this.getType(),"removed envelope, envelopes",c);t.call(this,a)}};b.onClose=function(){this._debug("Transport",this.getType(),"closed",h);k=d;for(var a in i)clearTimeout(i[a]),delete i[a];for(var b in c)c[b].onFailure(h,c[b].messages,"closed"),delete c[b];g=2};b.send=function(b,e){this._debug("Transport",this.getType(),"sending",b,"metaConnect =",
e);for(var i=[],s=0;s<b.messages.length;++s){var m=b.messages[s];m.id&&i.push(m.id)}c[i.join(",")]=b;this._debug("Transport",this.getType(),"stored envelope, envelopes",c);if(1===g)a.call(this,b,e);else{i=b.url.replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",i);h=new window.WebSocket(i);var k=this;h.onopen=function(){k._debug("WebSocket opened",h);d=!0;g=1;t=b.onSuccess;a.call(k,b,e)};h.onclose=function(){k.onClose()};h.onmessage=function(a){k.onMessage(a)}}};b.reset=
function(){j.reset();h&&h.close();k=!0;d=!1;g=2;i={};c={};t=h=null};return b};
org.cometd.Cometd=function(a){function j(a,b,d){for(var c=b||{},h=2;h<arguments.length;++h){var e=arguments[h];if(!(void 0===e||null===e))for(var f in e){var g=e[f];g!==b&&void 0!==g&&(c[f]=a&&"object"===typeof g&&null!==g?g instanceof Array?j(a,[],g):j(a,{},g):g)}}return c}function b(a){return org.cometd.Utils.isString(a)}function e(a){return void 0===a||null===a?!1:"function"===typeof a}function k(a,b){if(window.console){var d=window.console[a];e(d)&&d.apply(window.console,b)}}function d(){"warn"!=
x.logLevel&&k("info",arguments)}function g(){"debug"==x.logLevel&&k("debug",arguments)}function i(){for(var a in C)for(var b=C[a],d=0;d<b.length;++d){var c=b[d];c&&!c.listener&&(delete b[d],g("Removed subscription",c,"for channel",a))}}function c(a){p!=a&&(g("Status",p,"->",a),p=a)}function h(){return"disconnecting"==p||"disconnected"==p}function t(a,b,c,h,f){try{return b.call(a,h)}catch(i){g("Exception during execution of extension",c,i);a=S.onExtensionException;if(e(a)){g("Invoking extension exception callback",
c,i);try{a.call(S,i,c,f,h)}catch(l){d("Exception during execution of exception callback in extension",c,l)}}return h}}function f(a,b){var c=C[a];if(c&&0<c.length)for(var h=0;h<c.length;++h){var f=c[h];if(f)try{f.callback.call(f.scope,b)}catch(i){g("Exception during notification",f,b,i);var l=S.onListenerException;if(e(l)){g("Invoking listener exception callback",f,i);try{l.call(S,i,f.handle,f.listener,b)}catch(m){d("Exception during execution of listener callback",f,m)}}}}}function l(a,b){f(a,b);
for(var c=a.split("/"),d=c.length-1,h=d;0<h;--h){var e=c.slice(0,h).join("/")+"/*";h==d&&f(e,b);e+="*";f(e,b)}}function q(a){null!==O&&clearTimeout(O);O=null;var b=J.interval+A;g("Function scheduled in",b,"ms, interval =",J.interval,"backoff =",A,a);O=org.cometd.Utils.setTimeout(S,a,b)}function s(a,b,c,d){for(var h=0;h<b.length;++h){var f=b[h];f.id=""+ ++ca;U&&(f.clientId=U);for(var i=0;i<K.length&&!(void 0===f||null===f);++i){var l=K[i],m=l.extension.outgoing;e(m)&&(l=t(l.extension,m,l.name,f,!0),
f=void 0===l?f:l)}void 0!==f&&null!==f?b[h]=f:b.splice(h--,1)}0!==b.length&&(h=x.url,x.appendMessageTypeToURL&&(h.match(/\/$/)||(h+="/"),d&&(h+=d)),a={url:h,sync:a,messages:b,onSuccess:function(a){try{w.call(S,a)}catch(b){g("Exception during handling of messages",b)}},onFailure:function(a,b,c,n){try{L.call(S,a,b,c,n)}catch(ra){g("Exception during handling of failure",ra)}}},g("Send",a),H.send(a,c))}function m(a){0<Q||!0===D?I.push(a):s(!1,[a],!1)}function P(){var a=I;I=[];0<a.length&&s(!1,a,!1)}function r(){c("connecting");
q(function(){if(!h()){var a={channel:"/meta/connect",connectionType:H.getType()};M||(a.advice={timeout:0});c("connecting");g("Connect sent",a);s(!1,[a],!0,"connect");c("connected")}})}function F(a){a&&(J=j(!1,{},x.advice,a),g("New advice",J))}function z(a){null!==O&&clearTimeout(O);O=null;a&&H.abort();U=null;c("disconnected");A=Q=0;0<I.length&&(L.call(S,void 0,I,"error","Disconnected"),I=[])}function ia(a){U=null;i();h()?(v.reset(),F(x.advice)):F(j(!1,J,{reconnect:"retry"}));Q=0;D=!0;V=a;var a=v.findTransportTypes("1.0",
W,x.url),b=j(!1,{},V,{version:"1.0",minimumVersion:"0.9",channel:"/meta/handshake",supportedConnectionTypes:a,advice:{timeout:J.timeout,interval:J.interval}});H=v.negotiateTransport(a,"1.0",W,x.url);g("Initial transport is",H.getType());c("handshaking");g("Handshake sent",b);s(!1,[b],!1,"handshake")}function ja(){c("handshaking");D=!0;q(function(){ia(V)})}function ea(a){l("/meta/handshake",a);l("/meta/unsuccessful",a);!h()&&"none"!=J.reconnect?(A<x.maxBackoff&&(A+=x.backoffIncrement),ja()):z(!1)}
function Y(a){l("/meta/connect",a);l("/meta/unsuccessful",a);a=h()?"none":J.reconnect;switch(a){case "retry":A<x.maxBackoff&&(A+=x.backoffIncrement);r();break;case "handshake":v.reset();A=0;ja();break;case "none":z(!1);break;default:throw"Unrecognized advice action"+a;}}function X(a){z(!0);l("/meta/disconnect",a);l("/meta/unsuccessful",a)}function fa(a){l("/meta/subscribe",a);l("/meta/unsuccessful",a)}function R(a){l("/meta/unsubscribe",a);l("/meta/unsuccessful",a)}function ga(a){l("/meta/publish",
a);l("/meta/unsuccessful",a)}function Z(a){for(var b=0;b<K.length&&!(void 0===a||null===a);++b){var c=K[x.reverseIncomingExtensions?K.length-1-b:b],d=c.extension.incoming;e(d)&&(c=t(c.extension,d,c.name,a,!1),a=void 0===c?a:c)}if(!(void 0===a||null===a))switch(F(a.advice),a.channel){case "/meta/handshake":if(a.successful){U=a.clientId;b=v.negotiateTransport(a.supportedConnectionTypes,a.version,W,x.url);if(null===b)throw"Could not negotiate transport with server; client "+v.findTransportTypes(a.version,
W,x.url)+", server "+a.supportedConnectionTypes;H!=b&&(g("Transport",H,"->",b),H=b);D=!1;P();a.reestablish=ha;ha=!0;l("/meta/handshake",a);a=h()?"none":J.reconnect;switch(a){case "retry":A=0;r();break;case "none":z(!1);break;default:throw"Unrecognized advice action "+a;}}else ea(a);break;case "/meta/connect":if(M=a.successful)switch(l("/meta/connect",a),a=h()?"none":J.reconnect,a){case "retry":A=0;r();break;case "none":z(!1);break;default:throw"Unrecognized advice action "+a;}else Y(a);break;case "/meta/disconnect":a.successful?
(z(!1),l("/meta/disconnect",a)):X(a);break;case "/meta/subscribe":a.successful?l("/meta/subscribe",a):fa(a);break;case "/meta/unsubscribe":a.successful?l("/meta/unsubscribe",a):R(a);break;default:void 0===a.successful?a.data?l(a.channel,a):g("Unknown message",a):a.successful?l("/meta/publish",a):ga(a)}}function E(a){if(a=C[a])for(var b=0;b<a.length;++b)if(a[b])return!0;return!1}function T(a,c){var d={scope:a,method:c};if(e(a))d.scope=void 0,d.method=a;else if(b(c)){if(!a)throw"Invalid scope "+a;d.method=
a[c];if(!e(d.method))throw"Invalid callback "+c+" for scope "+a;}else if(!e(c))throw"Invalid callback "+c;return d}function y(a,b,c,d){b=T(b,c);g("Adding listener on",a,"with scope",b.scope,"and callback",b.method);d={channel:a,scope:b.scope,callback:b.method,listener:d};b=C[a];b||(b=[],C[a]=b);b=b.push(d)-1;d.id=b;d.handle=[a,b];g("Added listener",d,"for channel",a,"having id =",b);return d.handle}var S=this,$=a||"default",W=!1,v=new org.cometd.TransportRegistry,H,p="disconnected",ca=0,U=null,Q=
0,I=[],D=!1,C={},A=0,O=null,K=[],J={},V,ha=!1,M=!1,x={maxConnections:2,backoffIncrement:1E3,maxBackoff:6E4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1E4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6E4,interval:0,reconnect:"retry"}};this._mixin=j;this._warn=function(){k("warn",arguments)};this._info=d;this._debug=g;var w,L;this.send=m;this.receive=Z;w=function(a){g("Received",a);for(var b=0;b<a.length;++b)Z(a[b])};L=function(a,b,c,d){g("handleFailure",
a,b,c,d);for(c=0;c<b.length;++c){var h=b[c];switch(h.channel){case "/meta/handshake":ea({successful:!1,failure:!0,channel:"/meta/handshake",request:h,xhr:a,advice:{reconnect:"retry",interval:A}});break;case "/meta/connect":d=a;M=!1;Y({successful:!1,failure:!0,channel:"/meta/connect",request:h,xhr:d,advice:{reconnect:"retry",interval:A}});break;case "/meta/disconnect":X({successful:!1,failure:!0,channel:"/meta/disconnect",request:h,xhr:a,advice:{reconnect:"none",interval:0}});break;case "/meta/subscribe":fa({successful:!1,
failure:!0,channel:"/meta/subscribe",request:h,xhr:a,advice:{reconnect:"none",interval:0}});break;case "/meta/unsubscribe":R({successful:!1,failure:!0,channel:"/meta/unsubscribe",request:h,xhr:a,advice:{reconnect:"none",interval:0}});break;default:ga({successful:!1,failure:!0,channel:h.channel,request:h,xhr:a,advice:{reconnect:"none",interval:0}})}}};this.registerTransport=function(a,b,c){if(c=v.add(a,b,c))g("Registered transport",a),e(b.registered)&&b.registered(a,this);return c};this.getTransportTypes=
function(){return v.getTransportTypes()};this.unregisterTransport=function(a){var b=v.remove(a);null!==b&&(g("Unregistered transport",a),e(b.unregistered)&&b.unregistered());return b};this.findTransport=function(a){return v.find(a)};this.configure=function(a){g("Configuring cometd object with",a);b(a)&&(a={url:a});a||(a={});x=j(!1,x,a);if(!x.url)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";a=/(^https?:)?(\/\/(([^:\/\?#]+)(:(\d+))?))?([^\?#]*)(.*)?/.exec(x.url);
W=a[3]&&a[3]!=window.location.host;if(x.appendMessageTypeToURL)if(void 0!==a[8]&&0<a[8].length)d("Appending message type to URI "+a[7]+a[8]+" is not supported, disabling 'appendMessageTypeToURL' configuration"),x.appendMessageTypeToURL=!1;else{var c=a[7].split("/"),h=c.length-1;a[7].match(/\/$/)&&(h-=1);0<=c[h].indexOf(".")&&(d("Appending message type to URI "+a[7]+" is not supported, disabling 'appendMessageTypeToURL' configuration"),x.appendMessageTypeToURL=!1)}};this.init=function(a,b){this.configure(a);
this.handshake(b)};this.handshake=function(a){c("disconnected");ha=!1;ia(a)};this.disconnect=function(a,b){if(!h()){void 0===b&&"boolean"!==typeof a&&(b=a,a=!1);var d=j(!1,{},b,{channel:"/meta/disconnect"});c("disconnecting");s(!0===a,[d],!1,"disconnect")}};this.startBatch=function(){++Q};this.endBatch=function(){--Q;if(0>Q)throw"Calls to startBatch() and endBatch() are not paired";0===Q&&(!h()&&!D)&&P()};this.batch=function(a,b){var c=T(a,b);this.startBatch();try{c.method.call(c.scope),this.endBatch()}catch(d){throw g("Exception during execution of batch",
d),this.endBatch(),d;}};this.addListener=function(a,c,d){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!b(a))throw"Illegal argument type: channel must be a string";return y(a,c,d,!0)};this.removeListener=function(a){if(!org.cometd.Utils.isArray(a))throw"Invalid argument: expected subscription, not "+a;var b=C[a[0]];b&&(delete b[a[1]],g("Removed listener",a))};this.clearListeners=function(){C={}};this.subscribe=function(a,c,d,f){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+
arguments.length;if(!b(a))throw"Illegal argument type: channel must be a string";if(h())throw"Illegal state: already disconnected";e(c)&&(f=d,d=c,c=void 0);var g=!E(a),i=y(a,c,d,!1);g&&(g=j(!1,{},f,{channel:"/meta/subscribe",subscription:a}),m(g));return i};this.unsubscribe=function(a,b){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(h())throw"Illegal state: already disconnected";this.removeListener(a);var c=a[0];E(c)||(c=j(!1,{},b,{channel:"/meta/unsubscribe",
subscription:c}),m(c))};this.clearSubscriptions=function(){i()};this.publish=function(a,c,d){if(1>arguments.length)throw"Illegal arguments number: required 1, got "+arguments.length;if(!b(a))throw"Illegal argument type: channel must be a string";if(h())throw"Illegal state: already disconnected";var f=j(!1,{},d,{channel:a,data:c});m(f)};this.getStatus=function(){return p};this.isDisconnected=h;this.setBackoffIncrement=function(a){x.backoffIncrement=a};this.getBackoffIncrement=function(){return x.backoffIncrement};
this.getBackoffPeriod=function(){return A};this.setLogLevel=function(a){x.logLevel=a};this.registerExtension=function(a,c){if(2>arguments.length)throw"Illegal arguments number: required 2, got "+arguments.length;if(!b(a))throw"Illegal argument type: extension name must be a string";for(var h=!1,f=0;f<K.length;++f)if(K[f].name==a){h=!0;break}if(h)return d("Could not register extension with name",a,"since another extension with the same name already exists"),!1;K.push({name:a,extension:c});g("Registered extension",
a);e(c.registered)&&c.registered(a,this);return!0};this.unregisterExtension=function(a){if(!b(a))throw"Illegal argument type: extension name must be a string";for(var c=!1,d=0;d<K.length;++d){var h=K[d];if(h.name==a){K.splice(d,1);c=!0;g("Unregistered extension",a);a=h.extension;e(a.unregistered)&&a.unregistered();break}}return c};this.getExtension=function(a){for(var b=0;b<K.length;++b){var c=K[b];if(c.name==a)return c.extension}return null};this.getName=function(){return $};this.getClientId=function(){return U};
this.getURL=function(){return x.url};this.getTransport=function(){return H};this.getConfiguration=function(){return j(!0,{},x)};this.getAdvice=function(){return j(!0,{},J)}};"undefined"!=typeof dojo&&dojo.provide("org.cometd.ReloadExtension");org.cometd.COOKIE||(org.cometd.COOKIE={},org.cometd.COOKIE.set=function(){throw"Abstract";},org.cometd.COOKIE.get=function(){throw"Abstract";});
org.cometd.ReloadExtension=function(a){function j(a){d&&null!==d.handshakeResponse&&(b(a),a=org.cometd.JSON.toJSON(d),k("Reload extension saving cookie value",a),org.cometd.COOKIE.set("org.cometd.reload",a,{"max-age":g,path:"/",expires:new Date((new Date).getTime()+1E3*g)}))}function b(a){a&&"number"===typeof a.cookieMaxAge&&(g=a.cookieMaxAge)}var e,k,d=null,g=5,i=!1;this.configure=b;this.registered=function(a,b){e=b;e.reload=j;k=e._debug};this.unregistered=function(){delete e.reload;e=null};this.outgoing=
function(a){var b=a.channel;if("/meta/handshake"==b){if(d={},d.url=e.getURL(),b=org.cometd.COOKIE.get("org.cometd.reload"),k("Reload extension found cookie value",b),b)try{org.cometd.COOKIE.set("org.cometd.reload","",{path:"/"});var g=org.cometd.JSON.fromJSON(b);if(g&&g.handshakeResponse&&d.url==g.url)return k("Reload extension restoring state",g),setTimeout(function(){k("Reload extension replaying handshake response",g.handshakeResponse);d.handshakeResponse=g.handshakeResponse;d.transportType=g.transportType;
d.reloading=!0;var a=e._mixin(!0,{},d.handshakeResponse);a.supportedConnectionTypes=[d.transportType];e.receive(a);k("Reload extension replayed handshake response",a)},0),i||(i=!0,e.startBatch()),null;k("Reload extension could not restore state",g)}catch(f){k("Reload extension error while trying to restore cookie",f)}}else"/meta/connect"==b&&!d.transportType&&(d.transportType=a.connectionType,k("Reload extension tracked transport type",d.transportType));return a};this.incoming=function(a){if(a.successful)switch(a.channel){case "/meta/handshake":d.handshakeResponse||
(d.handshakeResponse=a,k("Reload extension tracked handshake response",a));break;case "/meta/disconnect":d=null;break;case "/meta/connect":i&&(e.endBatch(),i=!1)}return a};b(a)};"undefined"!=typeof dojo&&dojo.provide("org.cometd.AckExtension");
org.cometd.AckExtension=function(){var a,j=!1,b=-1;this.registered=function(b,k){a=k;a._debug("AckExtension: executing registration callback",void 0)};this.unregistered=function(){a._debug("AckExtension: executing unregistration callback",void 0);a=null};this.incoming=function(e){var k=e.channel;if("/meta/handshake"==k)j=e.ext&&e.ext.ack,a._debug("AckExtension: server supports acks",j);else if(j&&"/meta/connect"==k&&e.successful&&(k=e.ext)&&"number"===typeof k.ack)b=k.ack,a._debug("AckExtension: server sent ack id",
b);return e};this.outgoing=function(e){var k=e.channel;"/meta/handshake"==k?(e.ext||(e.ext={}),e.ext.ack=a&&!1!==a.ackEnabled,b=-1):j&&"/meta/connect"==k&&(e.ext||(e.ext={}),e.ext.ack=b,a._debug("AckExtension: client sending ack id",b));return e}};var JSON;JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function j(a){k.lastIndex=0;return k.test(a)?'"'+a.replace(k,function(a){var b=i[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(a,e){var f,i,k,s,m=d,P,r=e[a];r&&("object"===typeof r&&"function"===typeof r.toJSON)&&(r=r.toJSON(a));"function"===typeof c&&(r=c.call(e,a,r));switch(typeof r){case "string":return j(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);case "object":if(!r)return"null";
d+=g;P=[];if("[object Array]"===Object.prototype.toString.apply(r)){s=r.length;for(f=0;f<s;f+=1)P[f]=b(f,r)||"null";k=0===P.length?"[]":d?"[\n"+d+P.join(",\n"+d)+"\n"+m+"]":"["+P.join(",")+"]";d=m;return k}if(c&&"object"===typeof c){s=c.length;for(f=0;f<s;f+=1)"string"===typeof c[f]&&(i=c[f],(k=b(i,r))&&P.push(j(i)+(d?": ":":")+k))}else for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(k=b(i,r))&&P.push(j(i)+(d?": ":":")+k);k=0===P.length?"{}":d?"{\n"+d+P.join(",\n"+d)+"\n"+m+"}":"{"+P.join(",")+
"}";d=m;return k}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
k=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,g,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,e,f){var i;g=d="";if("number"===typeof f)for(i=0;i<f;i+=1)g+=" ";else"string"===typeof f&&(g=f);if((c=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return b("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var h,e,g=a[d];if(g&&"object"===typeof g)for(h in g)Object.prototype.hasOwnProperty.call(g,h)&&(e=c(g,h),void 0!==e?g[h]=e:delete g[h]);return b.call(a,d,g)}var d,a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof b?c({"":d},""):d;throw new SyntaxError("JSON.parse");})})();(function(a){var j={"max-age":1800,path:"/"};a.cookie=function(b,e,k){if(1<arguments.length){var d=e,g=a.extend({},j,k);if(null===d||void 0===d)d="",g["max-age"]=0,g.expires=new Date((new Date).getTime()-1E3);d=b+"="+encodeURIComponent(d);g.expires&&g.expires.toUTCString&&(d+="; expires="+g.expires.toUTCString());g["max-age"]&&"number"===typeof g["max-age"]&&(d+="; max-age="+g["max-age"]);g.path&&(d+="; path="+g.path);g.domain&&(d+="; domain="+g.domain);g.secure&&(d+="; secure");document.cookie=d}else{a:{g=
document.cookie.split(";");for(d=0;d<g.length;++d){var i=a.trim(g[d]);if(i.substring(0,b.length+1)==b+"="){g=decodeURIComponent(i.substring(b.length+1));break a}}g=null}return g}}})(jQuery);(function(a){function j(a,b){if(b)for(var e in b)"content-type"!==e.toLowerCase()&&a.setRequestHeader(e,b[e])}function b(){var b=new org.cometd.LongPollingTransport,b=org.cometd.Transport.derive(b);b.xhrSend=function(b){return a.ajax({url:b.url,async:!0!==b.sync,timeout:6E4,type:"POST",dataType:"json",contentType:"application/json;charset=UTF-8",data:b.body,beforeSend:function(a){j(a,b.headers);return!0},success:b.onSuccess,error:function(a,e,c){b.onError(e,c)}})};return b}function e(){var b=new org.cometd.CallbackPollingTransport,
b=org.cometd.Transport.derive(b);b.jsonpSend=function(b){a.ajax({url:b.url,async:!0!==b.sync,type:"GET",dataType:"jsonp",jsonp:"jsonp",timeout:3E4,data:{message:b.body},beforeSend:function(a){j(a,b.headers);return!0},success:b.onSuccess,error:function(a,e,c){b.onError(e,c)}})};return b}org.cometd.JSON.toJSON=JSON.stringify;org.cometd.JSON.fromJSON=JSON.parse;a.Cometd=function(a){a=new org.cometd.Cometd(a);window.WebSocket&&a.registerTransport("websocket",new org.cometd.WebSocketTransport);a.registerTransport("long-polling",
new b);a.registerTransport("callback-polling",new e);return a};a.cometd=new a.Cometd})(jQuery);(function(a){a.cookie&&(org.cometd.COOKIE.set=a.cookie,org.cometd.COOKIE.get=a.cookie);a.cometd.registerExtension("reload",new org.cometd.ReloadExtension)})(jQuery);(function(a){a.GamecloudLogger=a.GamecloudLogger||{};try{console||(console={})}catch(j){console={}}console.log||(console.log=function(){});console.debug=console.debug||console.log;console.error=console.error||console.log;console.info=console.info||console.log;console.warn=console.warn||console.log;a.GamecloudLogger.getLogger=function(b){if(!b)return a.GamecloudLogger.loggerOnMock||(a.GamecloudLogger.loggerOnMock={},a.GamecloudLogger.loggerOnMock.log=function(){},a.GamecloudLogger.loggerOnMock.debug=
a.GamecloudLogger.loggerOnMock.log,a.GamecloudLogger.loggerOnMock.error=a.GamecloudLogger.loggerOnMock.log,a.GamecloudLogger.loggerOnMock.info=a.GamecloudLogger.loggerOnMock.log,a.GamecloudLogger.loggerOnMock.warn=a.GamecloudLogger.loggerOnMock.log),a.GamecloudLogger.loggerOnMock;if("console"==b)return console;a.GamecloudLogger.loggerOnHtml||(a.GamecloudLogger.loggerOnHtml={target:"string"==typeof b?"#"+b:b},a.GamecloudLogger.loggerOnHtml.log=function(b){a(this.target).append("<div>LOG : "+b+"</div>")},
a.GamecloudLogger.loggerOnHtml.debug=function(b){a(this.target).append("<div>DEBUG : "+b+"</div>")},a.GamecloudLogger.loggerOnHtml.error=function(b){a(this.target).append("<div>ERROR : "+b+"</div>")},a.GamecloudLogger.loggerOnHtml.info=function(b){a(this.target).append("<div>INFO : "+b+"</div>")},a.GamecloudLogger.loggerOnHtml.warn=function(b){a(this.target).append("<div>WARN : "+b+"</div>")});return a.GamecloudLogger.loggerOnHtml}})(jQuery);
(function(a){a.GCScope={ubiGCPlayerInvoke:1,profile:2,webagent:4,watch:8,gamenowAccount:16,gamecontent:32,getScope:function(a){var a=parseInt(a,10),b=[];if(isNaN(a))return"";for(var c in this)"getScope"!==c&&0<(this[c]&a)&&b.push(c);return b}};var j=a.GCScope,b=null,e={},k={},d={playerPlugin:!1},g=960,i=540,c={seq:0,records:{},start:function(){var a="id_"+this.seq++;this.records[a]=(new Date).getTime();return a},stop:function(a){if(void 0===this.records[a])return-1;var b=(new Date).getTime()-this.records[a];
delete this.records[a];return b},peak:function(a){return void 0===this.records[a]?-1:(new Date).getTime()-this.records[a]}},h={PLAYER_NOT_EMBEDDED:{code:"7010",message:"player not embedded"},PLAYER_NOT_INSTALLED:{code:"7020",message:"player not installed or not compatible"},INITIAL_FAILED:{code:"7003",message:"initial player failed"},LOGIN_PROCESSING:{code:"7201",message:"already accepted a login request and now processing"},NOT_LOGGED_IN:{code:"7202",message:"user has not logged in"},ALREADY_LOGGED_IN:{code:"7203",
message:"user has already logged in"},AUTH_FAILED:{code:"7200",message:"authentication failed"},PLAYER_TIMEOUT:{code:"7400",message:"request to player timeout"},PLAYER_ERROR:{code:"7404",message:"player internal error"},REQUEST_ERROR:{code:"9000",message:"Request Error: "},REQUEST_PROFILE_ERROR:{code:"9002",message:"Request to the profile server error."},REQUEST_GAMENOWACCOUNT_ERROR:{code:"9003",message:"Request to the gamenow account server error."},REQUEST_WATCH_ERROR:{code:"9004",message:"Request to the watch server error."},
REQUEST_CONTENT_ERROR:{code:"9005",message:"Request to the gamecontent server error."},REQUEST_AGENT_LOCATION_ERROR:{code:"9006",message:"Request agent location json error."},EMBED_PLAYER_ERROR:{code:"7007",message:"embed player failed or already exist"},UNEMBED_PLAYER_ERROR:{code:"7008",message:"unembed player failed"},CAPABILITY_ERROR:{code:"7401",message:"retrieve client capability failed"},VERSION_NOT_CONFIGURED:{code:"7005",message:"client version not configured at server, can't retrieve upgrade url"}};
a.GamecloudHook={};a.initialGamecloud=function(c){c=c||{};c.applicationid=c.applicationid||"application/ubitus-gamecloud-product-plugin";c.classid=c.classid||"CLSID:CD9D1DAD-2B65-4709-ABC2-12EA3BBA21D8";c.lazyEmbed=c.lazyEmbed||!1;b=a.GamecloudLogger.getLogger(c.debug);"object"!=typeof player&&(d.playerPlugin=!0);a.gamecloud=new a.Gamecloud(c)};a.Gamecloud=function(f){var l,q,s;function m(){return(new Date).getTime()+""}function t(){var a=navigator.userAgent.toLowerCase(),b=null;/windows/.test(a)?
b=p.defaultUserAgents.windows:/macintosh/.test(a)?b=p.defaultUserAgents.mac:/android/.test(a)?b=p.defaultUserAgents.android:/iphone/.test(a)?b=p.defaultUserAgents.iphone:/ipad/.test(a)&&(b=p.defaultUserAgents.ipad);return b||null}function r(b){return b&&"function"==typeof b?b:a.noop}function F(a,c){if(ba[a])return V=c?V|ba[a].code:V&~ba[a].code;b.log("# Gamecloud Log # Unknown status: "+a)}function z(a){return!ba[a]?(b.log("# Gamecloud Log # Unknown status: "+a),!1):0<(V&ba[a].code)?!0:!1}function ia(){R("reconnect",
{status:"start"});T("getAccountAndPassword",{id:m(),type:"get"},function(a){"200"==a.code&&a.account&&a.password?v.login({id:a.account,pwd:a.password,domain:a.domain,loginCallback:function(a){"0"==a.code?R("reconnect",{status:"succeed"}):(R("reconnect",{status:"failed"}),b.error("# Gamecloud Log # Login failed, connect failed."))}}):(R("reconnect",{status:"failed"}),b.error("# Gamecloud Log # Can't retrieve user account and password, connect failed."))},function(){b.error("# Gamecloud Log # Retrieve user account and password timeout, connect failed.");
R("reconnect",{status:"timeout"})})}function ja(){R("reconnect",{status:"start"});v.reconnectSNG({callback:function(a){a&&"0"==a.code?R("reconnect",{status:"succeed"}):(R("reconnect",{status:"failed"}),b.error("# Gamecloud Log # Login failed, connect failed."))}})}function ea(a,c,N){var d=N||new u;d.addApi("_initialPlayer");d.addScope(j.ubiGCPlayerInvoke);try{b.log("# Gamecloud Log # Try to invoke player.ubiGCPlayerInit()...");k.init=function(b,c){"200"!=b&&(d.toError("65"+b,c),a(d.get()))};var e=
player.ubiGCPlayerInit();if(void 0===e||!0===e)N=function(){d.toError(h.CAPABILITY_ERROR);a(d.get());c&&"function"==typeof c&&c()},E("getClientCapability",{id:m(),type:"get"},{timeout:N,response:function(b){b.successful?(v.userAgent=l=b.data.clientInfo.userAgent,v.version=q=b.data.clientInfo.clientVersion,s=b.data.clientInfo.uniqueId,K=b.data.clientInfo):d.toError(h.CAPABILITY_ERROR);F("playerReady",!0);a(d.get());c&&"function"==typeof c&&c()},template:new B(d,["clientInfo"])})||N()}catch(g){b.error("Invoke player.ubiGCPlayerInit() failed, exception: "+
g.message),d.toError(h.INITIAL_FAILED),a(d.get()),c&&"function"==typeof c&&c()}}function Y(n,c,N,e){if(!d.playerPlugin)throw b.error("# Gamecloud Log # Illegal access: embedPlayer() not supported in webview case"),"Exception: Illegal access: embedPlayer() not supported in webview case";if(!n||"object"!=typeof n||n instanceof Array&&0==n.length)throw b.error("# Gamecloud Log # Illegal arguments: embedPlayer() require a valid targetElm"),"Exception: Illegal arguments: embedPlayer() require a valid targetElm";
var f=N||new u;f.addApi("_embedPlayer");if(z("playerEmbedded")||document.getElementById("ubiPlayerPlugin")||"undefined"!=typeof player)b.warn("# Gamecloud Log # player already embedded in page, please unembed player before embed new player"),c(f.toError(h.EMBED_PLAYER_ERROR).get());else{var oa;n=a(n);try{var N=null,m=parseInt(p.playerWidth);if(isNaN(m)||1>m)m=g;var s=parseInt(p.playerHeight);if(isNaN(s)||1>s)s=i;N=/msie/.test(navigator.userAgent.toLowerCase())?['<object id="ubiPlayerPlugin" width="'+
m+'" height="'+s+'" classid="'+p.classid+'" style="visibility:hidden" >',"</object>"].join(""):['<embed type="'+p.applicationid+'" width="'+m+'" height="'+s+'" style="visibility:hidden" id="ubiPlayerPlugin" >',"</embed>"].join("");n.append(N);player=document.getElementById("ubiPlayerPlugin");oa=!0}catch(l){alert("Embed player object failed, exception: "+l.message),b.error("# Gamecloud Log # Embed player failed, exception: "+l.message),oa=!1}oa?(F("playerEmbedded",!0),setTimeout(function(){ea(c,e,
f)},100)):c(f.toError(h.EMBED_PLAYER_ERROR).get())}}function X(n,c){if(!d.playerPlugin)throw b.error("# Gamecloud Log # Illegal access: unembedPlayer() not supported in webview case"),"Exception: Illegal access: unembedPlayer() not supported in webview case";var N=c||new u;N.addApi("_unembedPlayer");var e=r(n);!z("playerEmbedded")||"undefined"==typeof player?(b.warn("# Gamecloud Log # player not embedded in page"),e(N.toError(h.UNEMBED_PLAYER_ERROR).get())):(F("playerEmbedded",!1),F("playerReady",
!1),player=void 0,a("#ubiPlayerPlugin").remove(),setTimeout(function(){e(N.toSuccess().get())},0))}function fa(b){L||(L=new a.UbiServerEventService(b),L.protocol=p.server+"/ugc/cometd");L.setUiJid(v.jid);L.setUserJid(v.clientFullJID);L.connect();L.addEventListener("notification",function(a){a.code&&(a.code=a.code.toString());if("901"==a.code){var b=null;try{b=ubitus.MSG.ERROR[a.code]?ubitus.MSG.ERROR[a.code].msg:a.message}catch(n){b=a.message}b&&T("announceMessage",{id:m(),type:"set",code:a.code,
displayText:b})}else if("902"==a.code){b=null;try{b=ubitus.MSG.ERROR[a.code]?ubitus.MSG.ERROR[a.code].msg:a.message}catch(c){b=a.message}b&&T("announceMessage",{id:m(),type:"set",code:a.code,displayText:b})}else"700"==a.code||"710"==a.code?R("maintenance",{code:a.code,message:a.message}):T("announceMessage",{id:m(),type:"set",code:a.code+"",displayText:a.message})})}function R(a,c){if(M[a]){var d=M[a],e;for(e in d)d[e].func(c),d[e].disposable&&delete d[e]}else b.error("# Gamecloud Log # Event '"+
a+"' not supported.")}function ga(b,c,N,e,h){var g=m();J[g]=e;b={id:g,token:c,type:"set",appType:"game",playUrl:b,dynamicUrl:N};if(h&&"object"==typeof h)for(var f in h)b[f]=h[f].toString;d.playerPlugin&&d.playerPlugin&&a("#ubiPlayerPlugin").css("visibility","visible");T("play",b)}function Z(a,b,c,d){var e=p.serverRealIP?p.serverRealIP:p.server?p.server:window.location.protocol+"//"+window.location.host,e=e+"/ugc/getDui.action?gameId="+a+"&domain="+b+"&hostUserAgent="+c;d&&(e=e+"&inputUserAgent="+
d);return e.replace("https","http")}function E(n,c,d){d=d||{};var e=d.timeout,g=d.response,f=a.GCResponseAdapter.ubiGCPlayerInvoke,i=d.template||new u;i.addApi("_ubiGCPlayerInvoke: "+n);var m="";try{m=JSON.stringify(c)}catch(s){return b.error("# Gamecloud Log # Invoke player failed, can't stringify json, exception: "+s.message),!1}d=m;500<d.length&&(d=d.substr(0,500)+"...(the rest string has been ignored)");b.log("# Gamecloud Log # Invoke player function:'"+n+"', parameter:"+d);var l=null;e&&(l=setTimeout(function(){b.error("# Gamecloud Log # Invoke player timeout, function:'"+
n+"', parameter:"+m);i.destory();e(f(i,h.PLAYER_TIMEOUT).get())},p.playerTimeout));g&&l?k[c.id]=function(a){clearTimeout(l);g(f(i,a).get())}:g?k[c.id]=function(a){g(f(i,a).get())}:l?k[c.id]=function(){i.destory();clearTimeout(l)}:i.destory();try{return player.ubiGCPlayerInvoke(n,m),!0}catch(r){return b.error("# Gamecloud Log # Invoke player failed, exception: "+r.message),l&&clearTimeout(l),k[c.id]&&delete k[c.id],!1}}function T(a,c,d,e){if(player){var h="";try{h=JSON.stringify(c)}catch(g){return b.error("# Gamecloud Log # Invoke player failed, can't stringify json, exception: "+
g.message),!1}var f=h;500<f.length&&(f=f.substr(0,500)+"...(the rest string has been ignored)");b.log("# Gamecloud Log # Invoke player function:'"+a+"', parameter:"+f);var i=null;e&&(i=setTimeout(function(){b.error("# Gamecloud Log # Invoke player timeout, function:'"+a+"', parameter:"+h);e()},p.playerTimeout));d&&i?k[c.id]=function(a){clearTimeout(i);d(a)}:d?k[c.id]=function(a){d(a)}:i&&(k[c.id]=function(){clearTimeout(i)});try{return player.ubiGCPlayerInvoke(a,h),!0}catch(m){return b.error("# Gamecloud Log # Invoke player failed, exception: "+
m.message),i&&clearTimeout(i),k[c.id]&&delete k[c.id],!1}}else b.log("# Gamecloud Log # Error! Player not found!")}function y(a,b,c,d){d=d||"REQUEST_ERROR";b={code:h[d].code,message:h[d].message+c};if(a&&a.responseText){c=null;try{var c=JSON.parse(a.responseText),e;for(e in c)b[e]=c[e]}catch(g){}}return b}function S(n,c){var e=null,g=r(n.loginCallback),f=n.responseTemplate||new u,i=a.GCResponseAdapter.webagent;f.addApi("_doLogin");z("processingLogin")?e=h.LOGIN_PROCESSING:z("userLogined")&&(e=h.ALREADY_LOGGED_IN);
if(e)setTimeout(function(){g(f.toError(e).get())},0);else{F("processingLogin",!0);b.log("# Gamecloud Log # Login by id:"+n.id+", user agent: "+l+", version: "+q);var k="?d="+(n.domain||p.domain)+"&u="+(l||t());a.ajax({url:p.server+(c?"/ugc/loginBySocialNetwork.action"+k:"/ugc/login.action"+k)+G.getRequestTimeStamp("&"),type:"post",cache:!1,data:{id:n.id,password:n.pwd,token:n.token||"",domain:n.domain||p.domain,userAgent:l||t(),loginMethod:n.loginMethod||p.loginMethod,"clientCapability.uniqueId":s,
"clientCapability.clientVersion":q||"0.0.0"},success:function(a){i(f,a||{});a=f.snapshot();a.successful?(c?ka=p.enableDefaultReconnectHandler?ja:null:(ka=p.enableDefaultReconnectHandler?ia:null,d.playerPlugin||(n.persist?E("saveAccountAndPassword",{id:m(),type:"set",account:n.id,password:n.pwd,domain:n.domain||p.domain,cleanRecord:"false"},{}):E("saveAccountAndPassword",{id:m(),type:"set",account:"",password:"",domain:"",cleanRecord:"true"},{}))),v.jid=a.data.jid,v.clientFullJID=a.data.clientFullJID,p.userDomain=
n.domain||p.domain,fa({debug:p.debug}),w.cleanCache(),F("userLogined",!0),f.toSuccess()):(b.log("authentication failed, code:"+a.code+", message : "+a.message),f.toError(h.AUTH_FAILED));F("processingLogin",!1);g(f.get())},error:function(a,n,c){a=y(a,n,c);i(f,a);a=f.snapshot();a.code!=h.REQUEST_ERROR.code&&(b.log("authentication failed, code:"+a.code+", message : "+a.message),f.toError(h.AUTH_FAILED));F("processingLogin",!1);g(f.get())}})}}function $(n){b.log("# Gamecloud Log # play()...");var c=null,
d=n.responseTemplate||new u,e=a.GCResponseAdapter.webagent;d.addApi("_play");z("playerEmbedded")?z("playerReady")?z("userLogined")||(c=h.NOT_LOGGED_IN):c=h.PLAYER_NOT_INSTALLED:c=h.PLAYER_NOT_EMBEDDED;if(c)b.log("# Gamecloud Log # "+c.message),d.toError(c),setTimeout(function(){n.callback(d.get())},0);else{delete aa.playStatusCallback;var g={jid:this.jid,gameId:n.gameId,sharedStreamingSessionId:n.sharedStreamingSessionId||""};if(n.properties&&"object"==typeof n.properties)for(var f in n.properties)g["props."+
f]=n.properties[f];W({gameId:n.gameId,responseTemplate:new B(d),callback:function(b){b.successful?a.ajax({url:p.server+"/ugc/playGame.action"+G.getRequestTimeStamp("?"),data:g,type:"post",cache:!1,timeout:p.playTimeout,success:function(a){e(d,a||{});a=d.snapshot();if(a.successful){aa.playStatusCallback=n.playerStatusCallback;var b=Z(n.gameId,p.userDomain||p.domain,l);ga(a.data.gameplay.playUrl,a.data.gameplay.randomValue||null,b,n.gameId,n.settings);A=n.gameId;O=a.data.gameplay.randomValue}n.callback(d.get())},
error:function(a,b,c){a=y(a,b,c);n.callback(e(d,a).get())}}):n.callback(d.get())}})}}function W(n){var c=r(n?n.callback:null),d=""+n.gameId,e=n.responseTemplate||new u;e.addApi("_getProfile");H[l]&&H[l][d]&&z("playerEmbedded")&&z("playerReady")?(e.toSuccess(),e.setData({clientMediaProfile:H[l][d]}),E("putClientProfile",{id:m(),type:"set",data:H[l][d]},{template:e,response:c,timeout:c})):(e.addScope(j.profile),a.ajax({url:p.profileServer+"/profiles/ubilive/"+l+"/"+d+"/gc_profile_cfg.xml",cache:!1,
dataType:"jsonp",jsonp:"jsonp",success:function(a){e.toSuccess();e.setData({clientMediaProfile:a});H[l]=H[l]||{};H[l][d]=a;z("playerEmbedded")&&z("playerReady")?E("putClientProfile",{id:m(),type:"set",data:a},{template:e,response:c,timeout:c}):c(e.get())},error:function(n,d,h){b.error("# Gamecloud Log # getProfile() exception: "+h);n=y(n,d,h,"REQUEST_PROFILE_ERROR");(0,a.GCResponseAdapter.profile)(e,n);c(e.get())}}))}var f=f||{},v=this,H={},p={debug:f.debug||"",server:"",serverRealIP:"",profileServer:"",
watchServer:"",gamenowAccountServer:window.location.protocol+"//"+window.location.host+":8071",gamecontentServer:window.location.protocol+"//"+window.location.host+":8090",lazyEmbed:f.lazyEmbed||!1,applicationid:f.applicationid||"",classid:f.classid||"",enableDefaultReconnectHandler:!1,ajaxTimeout:1E4,playTimeout:6E4,playerTimeout:5E3,playerWidth:960,playerHeight:540,defaultUserAgents:{windows:"win32_win7_1280x720_pc.plugin.msie",mac:"osx_10.8_1280x720_mac.plugin.safari",android:"",iphone:"",ipad:""},
loginMethod:"UBILIVE_AUTH",domain:"ubilive",userDomain:null},ca=null,U=0,Q={};this.version=this.userAgent=s=q=l="";this.clientFullJID=this.jid=null;for(var I="server profileServer watchServer gamecontentServer gamenowAccountServer debug domain loginMethod playerWidth playerHeight ajaxTimeout playerTimeout playTimeout enableDefaultReconnectHandler serverRealIP".split(" "),D=0;D<I.length;D++){var C=I[D];void 0!==f[C]&&(void 0!=p[C]?p[C]=f[C]:this[C]=f[C])}if(f.defaultUserAgents)for(D in p.defaultUserAgents)f.defaultUserAgents[D]&&
"string"===typeof f.defaultUserAgents[D]&&(p.defaultUserAgents[D]=f.defaultUserAgents[D]);this.contextStatus=JSON.parse(JSON.stringify(d));this.props=JSON.parse(JSON.stringify(p));a.ajaxSetup({timeout:p.ajaxTimeout||1E4,dataType:"json"});var A=null,O=null,K=null,J={},V=0,ha=1E3,M={maintenance:{},back:{},reconnect:{}},x={uifocus:!0,uiblur:!0,gamefocus:!0,gameblur:!0},w=null,L=null,la=null,ka=null,aa={},G={getRequestTimeStamp:function(a){return(a||"?")+"_ts="+(new Date).getTime()}},ba={playerExist:{code:4},
playerEmbedded:{code:2},playerReady:{code:4},processingLogin:{code:8},userLogined:{code:16},loginByStaticData:{code:32},loginBySocialToken:{code:64},processingLogout:{code:128}},pa=!1;this.enableResponseLogger=function(a){pa=!!a};var B=function(a,b,c){var d=a,e=c;!d instanceof u&&(d=d.getOriginal());this.toSuccess=function(){d.toSuccess();return this};this.setDataParser=function(a){e=a};this.getDataParser=function(){return e};this.toError=function(a,b){d.toError(a,b);return this};this.addScope=function(a){d.addScope(a);
return this};this.addApi=function(a){d.addApi(a);return this};this.setData=function(a,n){d.setData(a,n||b);return this};this.get=function(){return d.snapshot()};this.snapshot=function(){return d.snapshot()};this.getOriginal=function(){return d};this.destory=function(){}},u=function(a,d,e){var h=c.start(),g=e,f={code:null,message:null,successful:!1,meta:{scope:0,responseTime:null,api:[]},data:null};isNaN(parseInt(d,10))||(f.meta.scope=parseInt(d,10));a&&f.meta.api.push(""+a);this.toSuccess=function(){f.code=
"0";f.message="success";f.successful=!0;return this};this.toError=function(a,b){"string"===typeof a||"number"===typeof a?(f.code=""+a,f.message=""+b):(a=a||{},f.code=""+a.code,f.message=""+a.message);f.successful=!1;return this};this.addScope=function(a){f.meta.scope|=a;return this};this.addApi=function(a){f.meta.api.push(""+a);return this};this.setDataParser=function(a){g=a};this.getDataParser=function(){return g};this.setData=function(a,n){var c=f,d="data";if(n&&n instanceof Array&&0<n.length)for(;0<
n.length;)c[d]=c[d]||{},c=c[d],d=n.shift();if(c[d])for(var e in a)void 0!=c[d][e]&&b.warn("# Gamecloud Log # resposne template overwrite the response data with key:"+e),c[d][e]=a[e];else c[d]=a;return this};this.snapshot=function(){var a=JSON.parse(JSON.stringify(f));a.meta.responseTime=c.peak(h);return a};this.get=function(){null==f.meta.responseTime&&(f.meta.responseTime=c.stop(h));pa&&b.log("# Gamecloud Response Log # '{0}': {1}".format(f.meta.api[0],JSON.stringify(f)));return f};this.destory=
function(){c.stop(h);f=h=null;for(var a in this)delete this[a]}},I=null,ma=f.callback,I=ma&&"function"==typeof ma?function(a){setTimeout(function(){ma(a)},0)}:a.noop,C=null;if(f.additional&&f.additional.checkVersion)var qa=f.additional.checkVersion,C=function(){v.checkVersion({useDefaultWhenUnknownUserAgent:!0,callback:qa})};var da=new u("_ini");d.playerPlugin?p.lazyEmbed?(v.userAgent=l=t(),v.version=q="10.0.0",da.toSuccess(),da.setData({userAgent:l,version:q},["clientInfo"]),I(da.get())):Y(a("#UbiEmbedPlayer"),
I,da,C):(F("playerEmbedded",!0),ea(I,C,da));w=new a.UbiCacheService({debug:p.debug});w.setTTL(f.cache||{});this.checkStatus=function(a){return z(a)};this.getClientInfo=function(a){b.log("# Gamecloud Log # getClientInfo()...");var c=r(a.callback),a=a.responseTemplate||new u;a.addApi("getClientInfo");a.toSuccess();a.setData({userAgent:l,version:q});c(a.get())};this.getInstallerUri=function(n){b.log("# Gamecloud Log # getInstallerUri()...");var c=r(n.callback),d=n.responseTemplate||new u;d.setDataParser({rename:{upgradeUrl:"uri"}});
var e=a.GCResponseAdapter.profile;a.ajax({url:p.profileServer+"/profiles/ubilive/"+t()+"/0.0.0/check",cache:!1,success:function(a){a=e(d,a).snapshot();a.successful?d.toError(h.VERSION_NOT_CONFIGURED):("1000"==a.code||"1001"==a.code)&&d.toSuccess();c(d.get())},error:function(a,b,n){a=y(a,b,n,"REQUEST_PROFILE_ERROR");a=e(d,a).snapshot();a.successful?d.toError(h.VERSION_NOT_CONFIGURED):("1000"==a.code||"1001"==a.code)&&d.toSuccess();c(d.get())}})};this.setPlayer=function(b){var c=parseInt(b.width);if(isNaN(c)||
1>c)c=g;b=parseInt(b.height);if(isNaN(b)||1>b)b=i;if(p.playerWidth!=c){p.playerWidth=c;if(!d.playerPlugin)return;a("#ubiPlayerPlugin").attr("width",p.playerWidth)}p.playerHeight!=b&&(p.playerHeight=b,d.playerPlugin&&a("#ubiPlayerPlugin").attr("height",p.playerHeight))};this.setReconnectHandler=function(a){la=a&&"function"==typeof a?function(){try{a()}catch(c){b.error("# Gamecloud Log # invoke reconnect handler failed, cause: "+c.message)}}:null};this.login=function(a){if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.login() exception : Illegal Arguments."),
"Exception: Illegal arguments: gamecloud.login()";(a.responseTemplate=a.responseTemplate||new u).addApi("login");S(a,!1)};this.loginBySocialNetwork=function(a){if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.loginBySocialNetwork() exception : Illegal Arguments."),"Exception: Illegal arguments: gamecloud.loginBySocialNetwork()";(a.responseTemplate=a.responseTemplate||new u).addApi("loginBySocialNetwork");S(a,!0)};this.loginByWebview=function(a){if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.loginByWebview() exception : Illegal Arguments."),
"Exception: Illegal arguments: gamecloud.loginByWebview()";(a.responseTemplate=a.responseTemplate||new u).addApi("loginByWebview");S(a,!1)};this.logout=function(n){b.log("# Gamecloud Log # logout()...");F("processingLogout",!0);var c=r(n?n.callback:{}),e=n.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("logout");var h=function(){v.jid=null;v.clientFullJID=null;p.userDomain=null;w.cleanCache();L.disconnect();F("userLogined",!1);d.playerPlugin||(n.cleanClientData&&E("saveAccountAndPassword",
{id:m(),type:"set",account:"",password:"",domain:"",cleanRecord:"true"},{}),n.cleanUserCookies&&E("clearUserCookies",{id:m(),type:"set"},{}));F("processingLogout",!1)};a.ajax({url:p.server+"/ugc/logout.action"+G.getRequestTimeStamp("?"),data:"jid="+this.jid,cache:!1,type:"post",success:function(a){h();c(f(e,a).get())},error:function(a,b,n){h();a=y(a,b,n);c(f(e,a).get())}})};this.addEventListener=function(a,c,d){if(M[a])if(!c||"function"!=typeof c)b.error("# Gamecloud Log # Illegal handler, must be a executable function.");
else{var e="listener_"+ha++;M[a][e]={func:function(a){setTimeout(function(){c(a)},0)},disposable:!0===d?!0:!1};b.info("# Gamecloud Log # listener on event:"+a+" added, listener id:"+e+".");return e}else x[a]?L.addEventListener(a,c,d):b.error("# Gamecloud Log # Event '"+a+"' not supported.")};this.removeEventListener=function(a,c){if(M[a])if(c)if("string"==typeof c)M[a][c]?delete M[a][c]:b.info("# Gamecloud Log # Listener not exist.");else if("function"==typeof c){for(d in M[a])if(M[a][d].func===c){delete M[a][d];
return}b.info("# Gamecloud Log # Listener not exist.")}else b.error("# Gamecloud Log # Illegal handler, must be a executable function or string.");else{b.info("# Gamecloud Log # Remove all listeners in event:"+a);for(var d in M[a])delete M[a][d]}else x[a]?L.removeEventListener(a,c):b.error("# Gamecloud Log # Event '"+a+"' not supported.")};this.getCategory=function(c){b.log("# Gamecloud Log # getCategory()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;
e.addApi("getCategory");if(c=w.getDataRelation("user-category","user")){var h=w.getData("category",c);if(h){setTimeout(function(){d(e.toSuccess().setData({categories:h}).get())},0);return}}a.ajax({url:p.server+"/ugc/queryCategories.action",type:"get",success:function(a){f(e,a);w.setData("category",a.categories);for(var b=[],c=0;c<a.categories.length;c++)b.push(a.categories[c].id);w.setDataRelation("user-category","user",b);d(e.get())},error:function(a,b,c){a=y(a,b,c);d(f(e,a).get())}})};this.getGamePrivilegeList=
function(c){b.log("# Gamecloud Log # getGamePrivilegeList()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getGamePrivilegeList");var h={};c.productIds&&0<c.productIds.length&&("string"==typeof c.productIds?h.productIds=c.productIds:c.productIds instanceof Array&&(h.productIds=c.productIds));a.ajax({url:p.server+"/ugc/queryPrivileges.action"+G.getRequestTimeStamp("?"),type:"post",cache:!1,traditional:!0,data:h,success:function(a){d(f(e,a).get())},
error:function(a,b,c){a=y(a,b,c);d(f(e,a).get())}})};this.getOrderItemList=function(c){b.log("# Gamecloud Log # getOrderItemList()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getOrderItemList");a.ajax({url:p.server+"/ugc/queryOrders.action"+G.getRequestTimeStamp("?"),type:"post",cache:!1,success:function(a){d(f(e,a).get())},error:function(a,b,c){a=y(a,b,c);d(f(e,a).get())}})};this.getRankingInfos=function(c){b.log("# Gamecloud Log # getRankingInfos()...");
var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getRankingInfos");e.setDataParser({arrayToMap:{rankingInfos:"gameId"}});var h={};c.gameIds&&0<c.gameIds.length&&("string"==typeof c.gameIds?h.gameIds=c.gameIds:c.gameIds instanceof Array&&(h.gameIds=c.gameIds));a.ajax({url:p.server+"/ugc/queryRankingInfos.action"+G.getRequestTimeStamp("?"),data:h,type:"post",cache:!1,traditional:!0,success:function(a){d(f(e,a).get())},error:function(a,b,c){a=y(a,b,c);
d(f(e,a).get())}})};this.getPurchaseItemList=function(c){b.log("# Gamecloud Log # getPurchaseItemList()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getPurchaseItemList");var h=[],g=!1;if(c.productIds&&0<c.productIds.length)if("string"==typeof c.productIds){var i=w.getDataRelation("game-purchaseItem",c.productIds);i&&(h=h.concat(i),g=!0)}else if("object"==typeof c.productIds)for(var m=0;m<c.productIds.length;m++)if(i=w.getDataRelation("game-purchaseItem",
c.productIds[m]))h=h.concat(i),g=!0;else{g=!1;break}if(g&&(h=w.getData("purchaseItem",h))){d(e.toSuccess().setData({purchaseItems:h}).get());return}h={};c.productIds&&0<c.productIds.length&&("string"==typeof c.productIds?h.productIds=c.productIds:c.productIds instanceof Array&&(h.productIds=c.productIds));a.ajax({url:p.server+"/ugc/queryPurchaseItems.action"+G.getRequestTimeStamp("?"),data:h,type:"post",cache:!1,traditional:!0,success:function(a){a=f(e,a).snapshot();if(a.successful){a=a.data.purchaseItems;
w.setData("purchaseItem",a);for(var b={},c=0;c<a.length;c++)b[a[c].productId]||(b[a[c].productId]=[]),b[a[c].productId].push(a[c].itemNo);for(c in b)w.setDataRelation("game-purchaseItem",c,b[c])}d(e.get())},error:function(a,b,c){a=y(a,b,c);d(f(e,a).get())}})};this.getPackageList=function(c){b.log("# Gamecloud Log # getPackageList()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,h=a.GCResponseAdapter.webagent;e.addApi("getPackageList");if((!c.startPosition||0==c.startPosition)&&!c.count){var f=
w.getDataRelation("user-package","user");if(f&&(f=w.getData("package",f))){e.toSuccess().setData({packs:f});setTimeout(function(){d(e.get())},0);return}}a.ajax({url:p.server+"/ugc/queryPackages.action",type:"get",data:{startPosition:c.startPosition||"",count:c.count||""},success:function(a){a=h(e,a).snapshot();if(a.successful&&(a=a.data.packs,w.setData("package",a),(!c.startPosition||0==c.startPosition)&&!c.count)){for(var b=[],f={},g=0;g<a.length;g++){b.push(a[g].id);w.setDataRelation("package-game",
a[g].id,a[g].games);for(var i=0;i<a[g].games.length;i++){var m=a[g].games[i];f[m]?f[m].push(a[g].id):f[m]=[a[g].id]}}for(g in f)w.setDataRelation("game-package",g,f[g]);w.setDataRelation("user-package","user",b)}d(e.get())},error:function(a,b,c){a=y(a,b,c);d(h(e,a).get())}})};this.getPackageDetail=function(c){b.log("# Gamecloud Log # getPackageDetail()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getPackageDetail");if(!c.noCache){var h=w.getData("package",
[c.packageId]);if(h){e.toSuccess().setData({pack:h[0]});setTimeout(function(){d(e.get())},0);return}}a.ajax({url:p.server+"/ugc/queryPackageDetail.action",type:"get",data:{"packageId ":c.packageId},success:function(a){a=f(e,a).snapshot();a.successful&&w.setData("package",[a.data.pack]);d(e.get())},error:function(a,b,c){a=y(a,b,c);d(f(e,a).get())}})};this.getListByIds=function(c){b.log("# Gamecloud Log # getListByIds()...");if(!c||!(c.gameIds instanceof Array))b.error("# Gamecloud Log # gamecloud.getListByIds() exception : Illegal Arguments.");
else{var d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getListByIds");for(var h=[],g=[],i=0;i<c.gameIds.length;i++){var m=w.getData("game",c.gameIds[i]);m?h.push(m):g.push(c.gameIds[i])}0==g.length?(e.toSuccess().setData({games:h,totalCount:h.length}),setTimeout(function(){d(e.get())},0)):a.ajax({url:p.server+"/ugc/queryGames.action",type:"get",data:{gameIds:g},cache:!1,traditional:!0,success:function(a){a=f(e,a).snapshot();if(a.successful){var b=a.data.games||
[];0<b.length?(a={gameIds:g,responseTemplate:new B(e),callback:function(a){var c={};a.successful&&a.data.rankingInfos&&(c=a.data.rankingInfos);for(a=0;a<b.length;a++){if(b[a].id&&c[b[a].id]){var n=c[b[a].id];b[a].ranking=n?n.ranking:0;b[a].rankingInfo=n||null}else b[a].ranking=0,b[a].rankingInfo=null;h.push(b[a])}w.setData("game",b);e.setData({games:h,totalCount:h.length});d(e.get())}},v.getRankingInfos(a)):(w.setData("game",b),e.setData({totalCount:h.length}),d(e.get()))}else d(e.get())},error:function(a,
b,c){a=y(a,b,c);d(f(e,a).get())}})}};this.getList=function(c){b.log("# Gamecloud Log # getList()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||new u,f=a.GCResponseAdapter.webagent;e.addApi("getList");if((!c.startPosition||0==c.startPosition)&&!c.count&&"History"!=c.categoryId&&"Favorite"!=c.categoryId){var h=w.getDataRelation("category-game",c.categoryId||"All");if(h&&(h=w.getData("game",h))){e.toSuccess().setData({games:h,totalCount:h.length});setTimeout(function(){d(e.get())},0);return}}a.ajax({url:p.server+
"/ugc/queryGames.action",type:"get",cache:!1,traditional:!0,data:{categoryId:c.categoryId||"",startPosition:c.startPosition||"",count:c.count||""},success:function(a){a=f(e,a).snapshot();if(a.successful){for(var b=a.data.games||[],a=[],h=0;h<b.length;h++)b[h].id&&a.push(b[h].id);if((!c.startPosition||0==c.startPosition)&&!c.count&&"History"!=c.categoryId&&"Favorite"!=c.categoryId)w.setDataRelation("category-game",c.categoryId||"All",a);0<a.length?(a={gameIds:a,responseTemplate:new B(e),callback:function(a){var c=
{};a.successful&&a.data.rankingInfos&&(c=a.data.rankingInfos);for(a=0;a<b.length;a++)if(b[a].id&&c[b[a].id]){var n=c[b[a].id];b[a].ranking=n?n.ranking:0;b[a].rankingInfo=n||null}else b[a].ranking=0,b[a].rankingInfo=null;w.setData("game",b);d(e.setData({games:b}).get())}},v.getRankingInfos(a)):(w.setData("game",b),d(e.get()))}else d(e.get())},error:function(a,b,c){a=y(a,b,c);d(f(e,a).get())}})};this.getDetail=function(c){b.log("# Gamecloud Log # getDetail()...");var c=c||{},d=r(c.callback),e=c.responseTemplate||
new u,h=a.GCResponseAdapter.webagent;e.addApi("getDetail");if(!c.noCache){var f=w.getData("game",[c.gameId]);if(f){setTimeout(function(){d(e.toSuccess().setData({game:f[0]}).get())},0);return}}a.ajax({url:p.server+"/ugc/queryGameDetail.action",type:"get",data:{gameId:c.gameId},success:function(a){var b=h(e,a).snapshot();b.successful?(a={gameIds:c.gameId,responseTemplate:new B(e),callback:function(a){var c={};a.successful&&a.data.rankingInfos&&(c=a.data.rankingInfos);b.data.game.id&&c[b.data.game.id]?
(a=c[b.data.game.id],b.data.game.ranking=a?a.ranking:0,b.data.game.rankingInfo=a||null):(b.data.game.ranking=0,b.data.game.rankingInfo=null);w.setData("game",[b.data.game]);d(e.toSuccess().setData({game:b.data.game}).get())}},v.getRankingInfos(a)):d(e.get())},error:function(a,b,c){a=y(a,b,c);d(h(e,a).get())}})};this.registerShareStreaming=function(c){b.log("# Gamecloud Log # registerShareStreaming()...");var d=r(c.callback,"registerShareStreaming callback exception.");a.ajax({url:p.server+"/ugc/registerSharedStreaming.action"+
G.getRequestTimeStamp("?"),type:"post",data:{jid:this.jid},cache:!1,async:!c.synchronously,success:function(a){d(a)},error:function(a,b,c){a=y(a,b,c);d(a)}})};this.reconnectSNG=function(c){if(!c||"object"!=typeof c)b.error("# Gamecloud Log # gamecloud.reconnectSNG() exception : Illegal Arguments.");else{b.log("# Gamecloud Log # reconnectSNG()...");var d=r(c.callback,"reconnectSNG callback exception."),e=null;z("processingLogin")?e=h.LOGIN_PROCESSING:z("userLogined")&&(e=h.ALREADY_LOGGED_IN);if(e)b.log(" # Gamecloud Log # "+
e.message),setTimeout(function(){d({code:e.code,message:e.message})},0);else{var f=r(function(a){"200"==a.code?v.loginBySocialNetwork({id:a.id,pwd:a.opt,loginCallback:d}):d(a)},"renewSNGToken callback exception.");a.ajax({url:p.server+"/sng/refresh",cache:!1,success:function(a){f(a)},error:function(a,b,c){a=y(a,b,c);f(a)}})}}};this.resumeSession=function(c){b.log("# Gamecloud Log # resumeSession()...");if(!c||"object"!=typeof c)throw b.error("# Gamecloud Log # Illegal arguments: resumeSession()"),
"Exception: Illegal arguments: resumeSession()";var d=r(c?c.callback:{}),e=c.responseTemplate||new u,h=a.GCResponseAdapter.webagent;e.addApi("resumeSession");a.ajax({url:p.server+"/ugc/queryTimestamp.action"+G.getRequestTimeStamp("?"),type:"post",data:{jid:c.jid},cache:!1,success:function(a){h(e,a);e.snapshot().successful&&(v.jid=c.jid,v.clientFullJID=c.clientFullJID,e.setData({jid:c.jid,clientFullJID:c.clientFullJID}),p.userDomain=c.domain||p.domain,fa({debug:p.debug}),w.cleanCache(),F("userLogined",
!0));d(e.get())},error:function(a,b,c){a=y(a,b,c);d(h(e,a).get())}})};this.embedAndCheck=function(a){if(!a||"object"!=typeof a)b.error("# Gamecloud Log # gamecloud.targetPlay() exception : Illegal Arguments.");else{var c=new u("embedAndCheck"),d=r(a.callback);Y(a.targetElm,function(a){a.successful?v.checkVersion({callback:d,responseTemplate:c}):(X(),(a.code==h.CAPABILITY_ERROR.code||a.code==h.INITIAL_FAILED.code)&&c.toError(h.PLAYER_NOT_INSTALLED),d(c.get()))},new B(c),null,!1)}};this.embedAndPlay=
function(a){if(!a||"object"!=typeof a)b.error("# Gamecloud Log # gamecloud.targetPlay() exception : Illegal Arguments.");else{var c=a.responseTemplate=a.responseTemplate||new u;c.addApi("embedAndPlay");var d=r(a.callback),e=r(a.checkVersionCallback),f=r(a.embedPlayerCallback);Y(a.targetElm,function(b){f(b);b.successful?v.checkVersion({callback:function(b){e(b);b.successful?a.resume?v.resumePlay(a):a.checkNetwork?v.locationPlay(a):$.apply(v,[a]):d(c.get())},responseTemplate:new B(c)}):(X(),(b.code==
h.CAPABILITY_ERROR.code||b.code==h.INITIAL_FAILED.code)&&c.toError(h.PLAYER_NOT_INSTALLED),d(c.get()))},new B(c),null)}};this.closeAndUnembed=function(a){var a=a||{},b=r(a.callback),c=a.responseTemplate||new u;c.addApi("closeAndUnembed");a={gameId:a.gameId,callback:function(){X(b,c)},responseTemplate:new B(c)};this.close(a)};this.unembed=function(){X(null,new u("unembed"))};this.resumePlay=function(a){b.log("# Gamecloud Log # resumePlay()...");var c=null,d=a.responseTemplate=a.responseTemplate||new u;
d.addApi("resumePlay");var e=r(a.callback);z("playerEmbedded")?z("playerReady")||(c=h.PLAYER_NOT_INSTALLED):c=h.PLAYER_NOT_EMBEDDED;c?(b.log("# Gamecloud Log # "+c.message),setTimeout(function(){e(d.toError(c).get())},0)):W({gameId:a.gameId,responseTemplate:new B(d),callback:function(c){if(c.successful){aa.playStatusCallback=a.playerStatusCallback;try{var h=Z(a.gameId,p.userDomain||p.domain,l);ga(a.playUrl,a.randomValue||null,h,a.gameId,a.settings);A=a.gameId;O=a.randomValue;e(d.toSuccess().get())}catch(f){b.log(f.message)}}else a.callback(d.get())}})};
this.locationPlay=function(c){b.log("# Gamecloud Log # locationPlay()...");var d=null,e=c.responseTemplate=c.responseTemplate||new u;e.addApi("locationPlay");var f=r(c.callback);z("playerEmbedded")?z("playerReady")||(d=h.PLAYER_NOT_INSTALLED):d=h.PLAYER_NOT_EMBEDDED;if(d)b.log("# Gamecloud Log # "+d.message),setTimeout(function(){f(e.toError(d).get())},0);else{var g=[];var i=e,m=function(a){if(a.successful)for(var b in a.data.agentLocation)"DEFAULT"!=b&&g.push(b);var d=a.data.agentLocation?a.data.agentLocation.DEFAULT||
null:null;0<g.length?(b={urlOptions:g,callback:function(b){b.successful&&(d=a.data.agentLocation[b.data.checkAvailableNetwork.url]||d);d&&(c.properties=c.properties||{},c.properties.agentLocation=d);$.apply(v,[c])},responseTemplate:new B(e,["checkAvailableNetwork"])},v.checkAvailableNetwork(b)):(d&&(c.properties=c.properties||{},c.properties.agentLocation=d),$.apply(v,[c]))},i=i||new u;i.addApi("_getAgentLocation");ca?(i.toSuccess(),i.setData({agentLocation:ca}),m(i.get())):a.ajax({url:p.server+"/cloudjs/agentLocation.json"+
G.getRequestTimeStamp("?"),type:"get",dataType:"json",cache:!1,success:function(a){a&&"object"==typeof a?(ca=a,i.toSuccess(),i.setData({agentLocation:a})):i.toError(h.REQUEST_AGENT_LOCATION_ERROR);m(i.get())},error:function(){i.toError(h.REQUEST_AGENT_LOCATION_ERROR);m(i.get())}})}};this.play=function(a){if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # Illegal arguments: play()"),"Exception: Illegal arguments: play()";(a.responseTemplate=a.responseTemplate||new u).addApi("play");a.resume?
this.resumePlay(a):a.checkNetwork?this.locationPlay(a):$.apply(this,[a])};this.playVideo=function(a){if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # Illegal arguments: playVideo()"),"Exception: Illegal arguments: playVideo()";(a.responseTemplate=a.responseTemplate||new u).addApi("playVideo");a.settings=a.settings||{};a.settings.appType="video";this.play(a)};this.getUserInfo=function(c){b.log("# Gamecloud Log # getUserInfo()...");a.ajax({url:p.server+"/ugc/getUserInfo.action"+G.getRequestTimeStamp("?"),
type:"post",data:{jid:this.jid},success:function(a){c.callback(a)},error:function(a,b,d){a=y(a,b,d);c.callback(a)}})};this.getCurrentPlayInfo=function(c){b.log("# Gamecloud Log # getCurrentPlayInfo()...");a.ajax({url:p.server+"/ugc/queryCurrentPlayInfo.action"+G.getRequestTimeStamp("?"),type:"post",data:{jid:this.jid},success:function(a){c.callback(a)},error:function(a,b,d){a=y(a,b,d);c.callback(a)}})};this.modifyFavorite=function(c){b.log("# Gamecloud Log # modifyFavorite()...");var d={jid:v.jid};
c.gameIds&&0<c.gameIds.length&&(d.gameId=c.gameIds);a.ajax({url:p.server+"/ugc/modifiedFavorites.action",type:"post",data:d,traditional:!0,success:function(a){c.callback(a)},error:function(a,b,d){a=y(a,b,d);c.callback(a)}})};this.rating=function(c){b.log("# Gamecloud Log # rating()...");a.ajax({url:p.server+"/ugc/rank.action"+G.getRequestTimeStamp("?"),type:"post",data:{jid:this.jid,gameId:c.gameId,score:c.score},success:function(a){c.callback(a)},error:function(a,b,d){a=y(a,b,d);c.callback(a)}})};
this.purchase=function(c){b.log("# Gamecloud Log # purchase()...");var d=c.responseTemplate=c.responseTemplate||new u;d.addApi("purchase");var e=a.GCResponseAdapter.webagent,f=r(c.callback);if(z("userLogined"))a.ajax({url:p.server+"/ugc/purchase.action"+G.getRequestTimeStamp("?"),type:"post",cache:!1,data:{itemNo:c.itemNo},success:function(a){w.cleanDataCache("purchaseItem");f(e(d,a).get())},error:function(a,b,c){a=y(a,b,c);f(e(d,a).get())}});else{var g=h.NOT_LOGGED_IN;b.log(g.message);setTimeout(function(){f(d.toError(g).get())},
0)}};this.close=function(c){b.log("# Gamecloud Log # close()...");var c=c||{},d=r(c.callback),e=a.GCResponseAdapter.webagent,f=c.responseTemplate||new u;f.addApi("close");f.addScope(j.webagent);O&&E("quitGame",{id:O,type:"set"},{template:new B(f,null)});O=A=null;a.ajax({url:p.server+"/ugc/bye.action"+G.getRequestTimeStamp("?"),data:{jid:v.jid,gameId:c.gameId},type:"post",cache:!1,success:function(a){d(e(f,a).get())},error:function(a,b,c){a=y(a,b,c);d(e(f,a).get())}})};this.checkVersion=function(c){b.log("# Gamecloud Log # checkVersion()...");
var d=a.GCResponseAdapter.profile,e=c.responseTemplate||new u;e.addApi("checkVersion");e.addScope(j.profile);var f=r(c?c.callback:null),h=c.useDefaultWhenUnknownUserAgent?t():null,g=c.useDefaultWhenUnknownUserAgent?"0.0.0":null,h=c.userAgent||l||h,c=c.version||q||g;h?a.ajax({url:p.profileServer+"/profiles/ubilive/"+h+"/"+c+"/check",cache:!1,success:function(a){f(d(e,a).get())},error:function(a,b,c){a=y(a,b,c,"REQUEST_PROFILE_ERROR");f(d(e,a).get())}}):(e.toError("7300","Unknown user agent"),f(e.get()))};
this.getProfile=function(a){b.warn("# Gamecloud Log # 'getProfile()' is decrepated, this function will be removed very soon.");r(a?a.callback:null)()};this.getClientCapability=function(){return K};this.exitApp=function(){E("exitApp",{id:m(),type:"set"})};this.updateClient=function(a){E("updateSoftware",{id:m(),type:"set",upgradeUrl:a.upgradeUrl||"",upgradeVideo:a.upgradeVideo||""})};this.announceClientMessage=function(a){E("announceMessage",{id:m(),type:"set",code:a.code,displayText:a.message})};
this.openWindow=function(a){b.log("# Gamecloud Log # openWindow()...");if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.openWindow() exception : Illegal Arguments."),"Exception: Illegal arguments: gamecloud.openWindow()";var c=r(a.callback),e=a.responseTemplate||new u;e.addApi("openWindow");d.playerPlugin?(window.open(a.url),c(e.toSuccess().get())):T("openWindow",{id:m(),type:"set",target:a.target,url:a.url,windowName:a.windowName||""},{timeout:function(){c(e.toError(h.PLAYER_TIMEOUT).get())},
response:function(a){a.successful?e.toSuccess():e.toError(h.PLAYER_ERROR);c(e.get())},template:new B(e,null)})};this.postWebviewMessage=function(a,c){b.log("# Gamecloud Log # postWebviewMessage()...");if(!a||"string"!=typeof a||!c||"string"!=typeof c)throw b.error("# Gamecloud Log # gamecloud.postWebviewMessage() exception : Illegal Arguments."),"Exception: Illegal arguments: gamecloud.postWebviewMessage()";player.ubiGCPlayerCommunicate(a,a)};this.addWebviewMessageListener=function(a){if(!a||"function"!=
typeof a)throw b.error("# Gamecloud Log # gamecloud.addWebviewMessageListener() exception : Illegal Arguments."),"Exception: Illegal arguments: gamecloud.addWebviewMessageListener()";var c="WEBVIEW_MSG_LISTENER_"+U++;Q[c]=a;return c};this.removeWebviewMessageListener=function(a){return Q[a]?(delete Q[a],!0):!1};window.ubiGCPlayerDelegate=function(a,b){for(var c in Q)Q[_id](a,b)};this.checkParentalCode=function(a){b.log("# Gamecloud Log # checkParentalCode()...");if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.checkParentalCode() exception : Illegal Arguments."),
"Exception: Illegal arguments: gamecloud.checkParentalCode()";var c=r(a.callback),d=a.responseTemplate||new u;d.addApi("checkParentalCode");E("checkParentalCode",{id:m(),type:"set",parental:a.parental?a.parental:""},{timeout:function(){c(d.toError(h.PLAYER_TIMEOUT).get())},response:function(a){a.successful?d.toSuccess():"400"==a.code?d.toError("7402","verification failed"):d.toError(h.PLAYER_ERROR);c(d.get())},template:new B(d,null)})};this.launchLocalApplication=function(a){b.log("# Gamecloud Log # launchLocalApplication()...");
if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.launchLocalApplication() exception : Illegal Arguments."),"Exception: Illegal arguments: gamecloud.launchLocalApplication()";var c=r(a.callback),d=a.responseTemplate||new u;d.addApi("launchLocalApplication");var e={};a.params&&(e.local=a.params.local&&!0===a.params.local?"true":"false",e.url=a.params.url);E("launchLocalApplication",{id:m(),type:"set",application:a.application,params:e},{timeout:function(){c(d.toError(h.PLAYER_TIMEOUT).get())},
response:function(a){a.successful?d.toSuccess():d.toError(h.PLAYER_ERROR);c(d.get())},template:new B(d,null)})};this.getAccountAndPassword=function(a){b.log("# Gamecloud Log # getAccountAndPassword()...");var c=r(a.callback),d=a.responseTemplate||new u;d.addApi("getAccountAndPassword");E("getAccountAndPassword",{id:m(),type:"get"},{timeout:function(){c(d.toError(h.PLAYER_TIMEOUT).get())},response:function(a){a.successful?d.toSuccess():d.toError(h.PLAYER_ERROR);c(d.get())},template:new B(d,null)})};
this.checkAvailableNetwork=function(a){b.log("# Gamecloud Log # checkAvailableNetwork()...");if(!a||"object"!=typeof a||!a.urlOptions||!(a.urlOptions instanceof Array))throw b.error("# Gamecloud Log # Illegal arguments: checkAvailableNetwork() require a valid urlOptions"),"Exception: Illegal arguments: checkAvailableNetwork() require a valid urlOptions";var c=r(a.callback),d=a.responseTemplate||new u;d.addApi("checkAvailableNetwork");E("checkAvailableNetwork",{id:m(),type:"set",properties:[{idcs:a.urlOptions.join(", ")}]},
{timeout:function(){c(d.toError(h.PLAYER_TIMEOUT).get())},response:function(a){a.successful?d.toSuccess():d.toError(h.PLAYER_ERROR);c(d.get())},template:new B(d,null,{rename:{location:"url"}})})};this.launchNativeUI=function(a){b.log("# Gamecloud Log # launchNativeUI()...");if(!a||"object"!=typeof a)throw b.error("# Gamecloud Log # gamecloud.launchNativeUI() exception : Illegal Arguments."),"Exception: Illegal arguments: gamecloud.launchNativeUI()";if(d.playerPlugin)throw b.error("# Gamecloud Log # gamecloud.launchNativeUI() exception : Illegal Access, this function is not supported in browser plugin."),
"Exception: Illegal access: gamecloud.launchNativeUI(), this function is not supported in browser plugin.";var c=r(a.callback),e=a.responseTemplate||new u;e.addApi("launchNativeUI");a=a.properties||[];E("launchNativeUI",{id:m(),type:"set",uiName:"settings",properties:a},{timeout:function(){c(e.toError(h.PLAYER_TIMEOUT).get())},response:function(a){a.successful?e.toSuccess():e.toError(h.PLAYER_ERROR);c(e.get())},template:new B(e,null)})};f={logger:b,cacheService:w,ubiGCPlayerCaller:T,ubiGCPlayerGetCapId:m,
createErrorFeedback:y,createSafeCallback:r,ubiUtility:G,GCProps:JSON.parse(JSON.stringify(p)),ResponseTemplate:u,ResponseTemplateWrapper:B};for(D in a.GamecloudHook){I={};if(a.GamecloudHook[D].ref)for(var na in a.GamecloudHook[D].ref)a.GamecloudHook[D].ref[na]&&(I[na]=f[na]);a.GamecloudHook[D].hook(this,I)}e.getPlayMetadata=function(a){void 0!=a.userAgent&&void 0!=a.id&&setTimeout(function(){T("getPlayMetadata",{id:a.id,type:"result",code:"200",message:"success",dynamicUrl:Z(A,p.userDomain||p.domain,
l,a.userAgent)})},0)};e.close=function(c){void 0!=c.id&&void 0!=J[c.id]?(O=A=null,a.ajax({url:p.server+"/ugc/bye.action"+G.getRequestTimeStamp("?"),data:{jid:v.jid,gameId:J[c.id]},type:"post",cache:!1,async:!1,success:function(){},error:function(a,c,d){b.log("# Gamecloud Log # bye.action failed, error: "+d)}})):b.error("# Gamecloud Log # Request close game failed, can't find id or game id.")};e.updateStatus=function(c){c.code="6"+c.code;("6302"==c.code||"6303"==c.code)&&d.playerPlugin&&a("#ubiPlayerPlugin").css("visibility",
"hidden");aa.playStatusCallback&&aa.playStatusCallback(c)};e.handleWebSession=function(a){switch(a.action){case "connect":if(d.playerPlugin)break;la?la(v):ka&&ka();break;case "disconnect":L?L.connected?v.logout({callback:function(){}}):b.info("# Gamecloud Log # Session not established yet, ignore disconnect request."):b.error("# Gamecloud Log # Enviroment not ready, can't execute disconnect action.")}};e.goBack=function(a){R("back",{});T("goBack",{id:a.id,type:"result",code:"200",message:"success"})}};
var t={close:function(a){e.close(a)},getPlayMetadata:function(a){e.getPlayMetadata(a)},updateStatus:function(a){e.updateStatus(a)},handleWebSession:function(a){e.handleWebSession(a)},log:function(a){b[a.level](a.message)},goBack:function(a){e.goBack(a)}};window.ubiGCPlayerCallback=function(a,c){b.log("# Gamecloud Log # ubiGCPlayerCallback called, function:'"+a+"', parameter:"+c);var d={};try{d=JSON.parse(c)}catch(e){return b.error("# Gamecloud Log # Invoke player failed, can't stringify json, exception: "+
e.message),!1}if(k[d.id])k[d.id](d),delete k[d.id];else if("function"==typeof t[a])t[a](d);else b.log("# Gamecloud Log # no callback handler for '"+a+"', ignore this callback.")};window.ubiGCPlayerInitCallback=function(a,c){b.log("# Gamecloud Log # ubiGCPlayerInitCallback called, code:'"+a+"', message:"+c);k.init&&(k.init(a,c),delete k.init)}})(jQuery);(function(a){function j(b,e,k){return function(d,g){for(var i=a.GCScope[b],c=null,c="function"===typeof e?e:function(a){return a&&a.code===e?!0:!1},h={},j=0;j<k.length;j++)h[k[j]]=!0;var f=d.getDataParser()||{};f.extract=f.extract||{};f.rename=f.rename||{};f.arrayToMap=f.arrayToMap||{};c(g)?d.toSuccess():d.toError(g.code,g.message);d.addScope(i);i={};for(j in g)if(!h[j])if(f.extract[j]){var c=g[j],l;for(l in c){var q=l;f.rename[l]&&(q=f.rename[l]);i[q]=c[l]}}else if(f.arrayToMap[j]){var c=g[j],q=
f.arrayToMap[j],s={};if(c&&c instanceof Array&&0<c.length)for(var m=0;m<c.length;m++)c[m]&&(c[m][q]&&"string"==typeof c[m][q]&&0<c[m][q].length)&&(s[c[m][q]]=c[m]);c=s;q=j;f.rename[j]&&(q=f.rename[j]);i[q]=c}else q=j,f.rename[j]&&(q=f.rename[j]),i[q]=g[j];d.setData(i);return d}}a.GCResponseAdapter=a.GCResponseAdapter||{};a.GCResponseAdapter.ubiGCPlayerInvoke=j("ubiGCPlayerInvoke","200",["code","message","type","id"]);a.GCResponseAdapter.profile=j("profile","0",["code","message"]);a.GCResponseAdapter.webagent=
j("webagent","0",["code","message"]);a.GCResponseAdapter.gamecontent=j("gamecontent","0",["code","message"]);a.GCResponseAdapter.watch=j("watch",function(a){a&&(a.code&&"9004"!=a.code)&&(a.code="8"+a.code);return a&&"8200"===a.code?!0:!1},["code","message"]);a.GCResponseAdapter.gamenowAccount=j("gamenowAccount",function(a){return a&&"200"===a.status?!0:!1},["status","version"])})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.getFreeList={ref:{logger:!0,cacheService:!0,createErrorFeedback:!0,createSafeCallback:!0,ResponseTemplate:!0,ResponseTemplateWrapper:!0,ubiUtility:!0,GCProps:!0},hook:function(j,b){function e(a,c,b){c.addApi("_getFreeListByFreeGameIds");a&&0==a.length?setTimeout(function(){b(c.toSuccess().setData({games:[],totalCount:0}).get())},0):q.getListByIds({gameIds:a,responseTemplate:c,callback:b})}function k(c,b,d){b.addApi("_getFreeListByAllGameIds");
if(c&&0==c.length)setTimeout(function(){d(b.toSuccess().setData({games:[],totalCount:0}).get())},0);else{var f=a.GCResponseAdapter.webagent,c={productIds:c,responseTemplate:new l(b)};a.ajax({url:t.server+"/ugc/queryPurchaseItems.action"+h.getRequestTimeStamp("?"),type:"post",cache:!1,data:c,traditional:!0,success:function(a){a=f(b,a).snapshot();if(a.successful){g.setData("purchaseItem",a.data.purchaseItems);for(var c={},h=[],i={},l=0;l<a.data.purchaseItems.length;l++){var s=a.data.purchaseItems[l];
if(s.itemPrice&&"0"==s.itemPrice.amount&&("GameTime"==s.itemType||"LifetimeGameSubscription"==s.itemType||"GameSubscription"==s.itemType))c[s.productId]=!0;i[s.productId]||(i[s.productId]=[]);i[s.productId].push(s)}for(l in c)h.push(l);for(l in i)g.setDataRelation("game-purchaseItem",l,i[l]);g.setDataRelation("category-game","free",h);e(h,b,d)}else d(b.get())},error:function(a,c,e){a=i(a,c,e);d(f(b,a).get())}})}}var d=b.logger,g=b.cacheService,i=b.createErrorFeedback,c=b.createSafeCallback,h=b.ubiUtility,
t=b.GCProps,f=b.ResponseTemplate,l=b.ResponseTemplateWrapper,q=j;q.getFreeList=function(a){d.log("# Gamecloud Log # getFreeList()...");var a=a||{},b=c(a.callback),h=a.responseTemplate||new f;h.addApi("getFreeList");if(a=g.getDataRelation("category-game","free"))e(a,h,b);else{var i=g.getDataRelation("category-game","All");i?k(i,h,b):q.getList({responseTemplate:new l(h),callback:function(a){if(a.successful){i=[];for(var c=0;c<a.data.games.length;c++)i.push(a.data.games[c].id);k(i,h,b)}else b(h.get())}})}}}}})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.getPrivilegedGameList={ref:{logger:!0,cacheService:!0,createErrorFeedback:!0,createSafeCallback:!0,ResponseTemplate:!0,ResponseTemplateWrapper:!0,ubiUtility:!0,GCProps:!0},hook:function(j,b){var e=b.logger,k=b.cacheService,d=b.createErrorFeedback,g=b.createSafeCallback,i=b.ubiUtility,c=b.GCProps,h=b.ResponseTemplate,t=b.ResponseTemplateWrapper;j.getPrivilegedGameList=function(b){e.log("# Gamecloud Log # getPrivilegedGameList()...");
var b=b||{},l=g(b.callback),q=b.responseTemplate||new h,s=a.GCResponseAdapter.webagent;q.addApi("getPrivilegedGameList");a.ajax({url:c.server+"/ugc/queryPrivileges.action"+i.getRequestTimeStamp("?"),type:"post",cache:!1,success:function(a){a=s(q,a).snapshot();if(a.successful){_purchasedGameIds=[];for(var c in a.data.orderItemsMap)_purchasedGameIds.push(c);c=_purchasedGameIds;var b=a.data.orderItemsMap;q.addApi("_getPrivilegedGameListByGameIds");if(c&&0==c.length)setTimeout(function(){l(q.toSuccess().setData({games:[],
totalCount:0}).get())},0);else{var d=k.getData("game",c);if(d){for(a=0;a<d.length;a++)if((c=d[a])&&c.id)c.orders=b[c.id];setTimeout(function(){l(q.toSuccess().setData({games:d,totalCount:d.length}).get())},0)}else j.getListByIds({gameIds:c,responseTemplate:new t(q),callback:function(a){if(a.successful){for(var c=0;c<a.data.games.length;c++){var d=a.data.games[c];d&&d.id&&(d.orders=b[d.id])}q.setData({games:a.data.games})}l(q.get())}})}}else l(q.get())},error:function(a,c,b){a=d(a,c,b);l(s(q,a).get())}})}}}})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.getGameNameByIds={ref:{logger:!0,cacheService:!0,createSafeCallback:!0,ResponseTemplate:!0,ResponseTemplateWrapper:!0},hook:function(a,b){var e=b.logger,k=b.cacheService,d=b.createSafeCallback,g=b.ResponseTemplate,i=b.ResponseTemplateWrapper;a.getGameNameByIds=function(c){e.log("# Gamecloud Log # getGameNameByIds()...");var c=c||{},b=d(c.callback),t=c.responseTemplate||new g;t.addApi("getGameNameByIds");var f={},l=[],q=[];if(c.gameIds instanceof
Array)l=c.gameIds;else if("string"===typeof c.gameIds)l.push(c.gameIds);else if(c.gameIds&&"object"==typeof c.gameIds)for(var s in c.gameIds)l.push(s);for(s=0;s<l.length;s++)(c=k.getData("game",l[s]))?f[l[s]]=c.name:q.push(l[s]);0==q.length?setTimeout(function(){b(t.toSuccess().setData({games:f}).get())},0):a.getListByIds({gameIds:q,responseTemplate:new i(t),callback:function(a){if(a.successful){if(a.data.games&&0<a.data.games.length)for(var c=0;c<a.data.games.length;c++)f[a.data.games[c].id]=a.data.games[c].name;
t.toSuccess().setData({games:f})}b(t.get())}})}}}})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.getPackagesByGameId={ref:{logger:!0,cacheService:!0,createSafeCallback:!0,createErrorFeedback:!0,ResponseTemplate:!0,ResponseTemplateWrapper:!0},hook:function(a,b){var e=b.logger,k=b.cacheService,d=b.createSafeCallback,g=b.ResponseTemplate,i=b.ResponseTemplateWrapper;a.getPackagesByGameId=function(c){e.log("# Gamecloud Log # getPackagesByGameId()...");var c=c||{},b=d(c.callback),t=c.responseTemplate||new g;t.addApi("getPackagesByGameId");
var f=k.getDataRelation("game-package",c.gameId);if(f){for(var l={},q=0;q<f.length;q++)l[f[q]]=f[q];a.getPackagesByIds({packIds:l,callback:b,responseTemplate:t})}else a.getPackageList({callback:function(d){d.successful?(f=k.getDataRelation("game-package",c.gameId))?a.getPackagesByGameId({gameId:c.gameId,callback:b,responseTemplate:t}):b(t.get()):b(t.get())},respnseTemplate:new i(t)})}}};a.GamecloudHook.getPackagesByIds={ref:{logger:!0,cacheService:!0,createSafeCallback:!0,createErrorFeedback:!0,ResponseTemplate:!0},
hook:function(j,b){var e=b.logger,k=b.cacheService,d=b.createSafeCallback,g=b.createErrorFeedback,i=b.GCProps,c=b.ResponseTemplate;j.getPackagesByIds=function(b){e.log("# Gamecloud Log # getPackagesByIds()...");var b=b||{},j=d(b.callback),f=b.responseTemplate||new c;f.addApi("getPackagesByIds");var l=[],q=[],s=[];if(b.packIds instanceof Array)q=b.packIds;else if("string"===typeof b.packIds)q.push(b.packIds);else if(b.packIds&&"object"==typeof b.packIds)for(var m in b.packIds)q.push(m);for(m=0;m<q.length;m++)(b=
k.getData("package",q[m]))?l.push(b):s.push(q[m]);0==s.length?setTimeout(function(){j(f.toSuccess().setData({packs:l}).get())},0):a.ajax({url:i.server+"/ugc/queryPackages.action",type:"get",data:{packageIds:s},cache:!1,traditional:!0,success:function(a){a=_responseAdapter(f,a).snapshot();a.successful&&k.setData("package",a.data.packs);j(f.get())},error:function(a,c,b){a=g(a,c,b);j(_responseAdapter(f,a).get())}})}}}})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.getPrivilegedList={ref:{logger:!0,cacheService:!0,createErrorFeedback:!0,createSafeCallback:!0,ResponseTemplate:!0,ResponseTemplateWrapper:!0,ubiUtility:!0,GCProps:!0},hook:function(j,b){function e(a){var c=[],b;for(b in a.gameIds)c.push(b);l.getListByIds({gameIds:c,callback:a.callback,responseTemplate:a.responseTemplate})}var k=b.logger,d=b.cacheService,g=b.createErrorFeedback,i=b.createSafeCallback,c=b.ResponseTemplate,h=b.ResponseTemplateWrapper,
t=b.GCProps,f=b.ubiUtility,l=j;l.getPrivilegedList=function(b){k.log("# Gamecloud Log # getPrivilegedList()...");var b=b||{},s=i(b.callback),m=b.responseTemplate||new c,j=a.GCResponseAdapter.webagent;m.addApi("getPrivilegedList");(b=d.getDataRelation("specific-game","privileged"))?e({gameIds:b,callback:s,responseTemplate:m}):a.ajax({url:t.server+"/ugc/queryPrivileges.action"+f.getRequestTimeStamp("?"),type:"post",cache:!1,traditional:!0,success:function(a){a=j(m,a).snapshot();if(a.successful){var c=
{},b={},f=!1,g=!1,i;for(i in a.data.orderItemsMap)"GAME_PACKAGE"===a.data.orderItemsMap[i][0].purchaseItem.productType?(c[i]=i,f=!0):(b[i]=i,g=!0);f?l.getPackagesByIds({packIds:c,callback:function(a){if(a.successful){if(a.data.packs&&0<a.data.packs.length)for(var c=0;c<a.data.packs.length;c++)for(var h=0;h<a.data.packs[c].games.length;h++)b[a.data.packs[c].games[h]]=a.data.packs[c].games[h];d.setDataRelation("specific-game","privileged",b);e({gameIds:b,callback:s,responseTemplate:m})}else s(m.get())},
responseTemplate:new h(m)}):g?(d.setDataRelation("specific-game","privileged",b),e({gameIds:b,callback:s,responseTemplate:m})):s(m.get())}else s(m.get())},error:function(a,c,b){a=g(a,c,b);s(j(m,a).get())}})}}}})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.watchService={ref:{logger:!0,createErrorFeedback:!0,createSafeCallback:!0,ResponseTemplate:!0,GCProps:!0},hook:function(j,b){var e=b.logger,k=b.createErrorFeedback,d=b.createSafeCallback,g=b.GCProps,i=b.ResponseTemplate;j.registerPerformer=function(c){e.log("# Gamecloud:Watch Log # registerPerformer()...");if(!c||"object"!=typeof c)throw e.error("# Gamecloud:Watch Log # gamecloud.registerPerformer() exception : Illegal Arguments."),
"Exception: Illegal arguments: registerPerformer()";var b=d(c.callback),j=c.responseTemplate||new i,f=a.GCResponseAdapter.watch;j.addApi("registerPerformer");var l={},q;for(q in c)"callback"===q||"synchronously"===q||(l[q]=c[q]);a.ajax({url:g.watchServer+"/watch/api/v1/performer/register",cache:!1,traditional:!0,type:"post",dataType:"json",async:!c.synchronously,data:l,success:function(a){b(f(j,a).get())},error:function(a,c,d){a=k(a,c,d,"REQUEST_WATCH_ERROR");b(f(j,a).get())}})};j.setupPerformer=
function(c){e.log("# Gamecloud:Watch Log # setupPerformer()...");if(!c||"object"!=typeof c)throw e.error("# Gamecloud:Watch Log # gamecloud.setupPerformer() exception : Illegal Arguments."),"Exception: Illegal arguments: setupPerformer()";var b=d(c.callback),j=c.responseTemplate||new i,f=a.GCResponseAdapter.watch;j.addApi("setupPerformer");a.ajax({url:g.watchServer+"/watch/api/v1/performer/source",cache:!1,traditional:!0,type:"post",dataType:"json",data:{roomId:c.roomId,authenticationKey:c.authenticationKey,
sourceUri:c.sourceUri},success:function(a){b(f(j,a).get())},error:function(a,c,d){a=k(a,c,d,"REQUEST_WATCH_ERROR");b(f(j,a).get())}})};j.retrievePerformer=function(c){e.log("# Gamecloud:Watch Log # retrievePerformer()...");if(!c||"object"!=typeof c)throw e.error("# Gamecloud:Watch Log # gamecloud.retrievePerformer() exception : Illegal Arguments."),"Exception: Illegal arguments: retrievePerformer()";var b=d(c.callback),j=c.responseTemplate||new i,f=a.GCResponseAdapter.watch;j.addApi("retrievePerformer");
a.ajax({url:g.watchServer+"/watch/api/v1/performer/retrieve",cache:!1,traditional:!0,type:"post",dataType:"json",data:{roomId:c.roomId,authenticationKey:c.authenticationKey},success:function(a){b(f(j,a).get())},error:function(a,c,d){a=k(a,c,d,"REQUEST_WATCH_ERROR");b(f(j,a).get())}})};j.curtaincall=function(c){e.log("# Gamecloud:Watch Log # curtaincall()...");if(!c||"object"!=typeof c)throw e.error("# Gamecloud:Watch Log # gamecloud.curtaincall() exception : Illegal Arguments."),"Exception: Illegal arguments: curtaincall()";
var b=d(c.callback),j=c.responseTemplate||new i,f=a.GCResponseAdapter.watch;j.addApi("curtaincall");a.ajax({url:g.watchServer+"/watch/api/v1/performer/curtaincall",cache:!1,traditional:!0,type:"post",dataType:"json",data:{roomId:c.roomId,authenticationKey:c.authenticationKey},success:function(a){b(f(j,a).get())},error:function(a,c,d){a=k(a,c,d,"REQUEST_WATCH_ERROR");b(f(j,a).get())}})}}}})(jQuery);(function(a){a.GamecloudHook=a.GamecloudHook||{};a.GamecloudHook.gamenowAccount={ref:{logger:!0,createErrorFeedback:!0,GCProps:!0,ResponseTemplate:!0,ResponseTemplateWrapper:!0},hook:function(j,b){var e=b.logger,k=b.createErrorFeedback,d=b.GCProps,g=b.ResponseTemplate;j.queryGAProfile=function(b){e.log("# Gamecloud:GA Log # queryGAProfile()...");if(!b||"object"!=typeof b)throw e.error("# Gamecloud:GA Log # gamecloud.queryGAProfile() exception : Illegal Arguments."),"Exception: Illegal arguments: queryGAProfile()";
var c=a.GCResponseAdapter.gamenowAccount,h=b.responseTemplate||new g;h.addApi("queryGAProfile");var j=b.callback&&"function"==typeof b.callback?b.callback:a.noop;a.ajax({url:d.gamenowAccountServer+"/ga/queryProfile",type:"post",xhrFields:{withCredentials:!0},cache:!1,success:function(a){j(c(h,a).get())},error:function(a,b,d){a=k(a,b,d,"REQUEST_GAMENOWACCOUNT_ERROR");j(c(h,a).get())}})};j.grantGATicket=function(b){e.log("# Gamecloud:GA Log # grantGATicket()...");if(!b||"object"!=typeof b)throw e.error("# Gamecloud:GA Log # gamecloud.grantGATicket() exception : Illegal Arguments."),
"Exception: Illegal arguments: grantGATicket()";var c=a.GCResponseAdapter.gamenowAccount,h=b.responseTemplate||new g;h.addApi("grantGATicket");var j=b.callback&&"function"==typeof b.callback?b.callback:a.noop;a.ajax({url:d.gamenowAccountServer+"/ga/grantTicket",type:"post",xhrFields:{withCredentials:!0},cache:!1,data:{service:b.service},success:function(a){j(c(h,a).get())},error:function(a,b,d){a=k(a,b,d,"REQUEST_GAMENOWACCOUNT_ERROR");j(c(h,a).get())}})}}}})(jQuery);(function(a){a.UbiCacheService=function(j){function b(a,c){var b=k[a]?k[a][c]:void 0;return void 0!=b?0==b?0:-1==b?-1:(new Date).getTime()+b:0}var j=j||{},e=a.GamecloudLogger.getLogger(j.debug),k={data:{},dataRelation:{}},d={category:{},game:{},"package":{},purchaseItem:{}},g={"user-category":{},"user-package":{},"category-game":{},"specific-game":{},"package-game":{},"game-package":{},"game-purchaseItem":{}};this.setTTL=function(a){a=a||{};a.data=a.data||{};a.dataRelation=a.dataRelation||{};for(var b in d)(a.data[b]||
0===a.data[b])&&this.setDataTTL(b,a.data[b]);for(b in g)(a.dataRelation[b]||0===a.dataRelation[b])&&this.setDataRelationTTL(b,a.dataRelation[b])};this.setDataTTL=function(a,b){k.data[a]=isNaN(parseInt(b,10))?-1:parseInt(b,10)};this.setDataRelationTTL=function(a,b){k.dataRelation[a]=isNaN(parseInt(b,10))?-1:parseInt(b,10)};this.getData=function(a,b){if(!d[a])return e.debug("# Cache Log # Data type:'"+a+"' not supported in cache service."),null;if(!b)return e.debug("# Cache Log # Illegale argument: ids."),
null;var h=d[a],g=(new Date).getTime();if("string"==typeof b){var f=h[b];return!f?(e.debug("# Cache Log # Data type:'"+a+"' with id:'"+b+"' is not available in cache."),null):-1!=f.expireTime&&g>f.expireTime?(delete d[a][b],e.debug("# Cache Log # Data type:'"+a+"' with id:'"+b+"' is expired in cache."),null):f.data}if("object"==typeof b){for(var j=[],k=0;k<b.length;k++){f=h[b[k]];if(!f)return e.debug("# Cache Log # Data type:'"+a+"' with id:'"+b[k]+"' is not available in cache."),null;if(-1!==f.expireTime&&
g>f.expireTime)return delete d[a][b[k]],e.debug("# Cache Log # Data type:'"+a+"' with id:'"+b[k]+"' is expired in cache."),null;j.push(f.data)}return JSON.parse(JSON.stringify(j))}e.debug("# Cache Log # Illegale argument data type: ids.");return null};this.setData=function(a,c){if(c)if(d[a]){var h=b("data",a);if(0===h)return e.debug("# Cache Log # type : '"+a+"' ttl not found, ignore cache result."),!0;switch(a){case "category":case "game":case "package":case "order":for(var g=0;g<c.length;g++)c[g]&&
c[g].id&&(delete d[a][c[g].id],d[a][c[g].id]={expireTime:h,data:JSON.parse(JSON.stringify(c[g]))});break;case "purchaseItem":for(g=0;g<c.length;g++)delete d.purchaseItem[c[g].itemNo],d.purchaseItem[c[g].itemNo]={expireTime:h,data:JSON.parse(JSON.stringify(c[g]))}}}else e.debug("# Cache Log # Data type:'"+a+"' not supported in cache service.");else e.debug("# Cache Log # Illegle data.")};this.getDataRelation=function(a,b){if(g[a]){var d=g[a][b];if(!d)return e.debug("# Cache Log # Data relation:'"+
a+"' with id:'"+b+"' is not available in cache."),null;var j=(new Date).getTime();return-1===d.expireTime?JSON.parse(JSON.stringify(d.data)):j>d.expireTime?(delete g[a][b],e.debug("# Cache Log # Data relation:'"+a+"' with id:'"+b+"' is expired in cache."),null):JSON.parse(JSON.stringify(d.data))}e.debug("# Cache Log # Data relation :'"+a+"' not supported in cache service.")};this.setDataRelation=function(a,c,d){if(g[a]){var j=b("dataRelation",a);if(0===j)return e.debug("# Cache Log # relation : '"+
a+"' ttl not found, ignore set cache."),!0;delete g[a][c];g[a][c]={expireTime:j,data:JSON.parse(JSON.stringify(d))}}else e.debug("# Cache Log # Data relation :'"+a+"' not supported in cache service.")};this.cleanDataCache=function(a){d[a]?d[a]={}:e.debug("# Cache Log # Data type:'"+a+"' not supported in cache service.")};this.cleanRelationCache=function(a){g[relation]?g[a]={}:e.debug("# Cache Log # Data relation :'"+relation+"' not supported in cache service.")};this.cleanCache=function(){for(var a in d)d[a]=
{};for(a in g)g[a]={}}}})(jQuery);(function(a){a.UbiServerEventService=function(j){function b(){q.GAME_PROCESS.subscription=a.cometd.subscribe(q.GAME_PROCESS.channel,function(a){k(q.GAME_PROCESS,a)})}function e(){q.GENERAL.subscription=a.cometd.subscribe(q.GENERAL.channel,function(a){k(q.GENERAL,a)})}function k(a,b){g.debug("# ServerEvent Log # Message received from channel: "+a.channelType);var c=d(b);c?a.handle(t,c):g.warn("# ServerEvent Log # Message from channel: "+a.channelType+" can't be resolved, ignore message.")}function d(a){if(!a)return g.warn("# ServerEvent Log # Message is '"+
a+"', can't be evaluated."),null;if(!a.data)return g.warn("# ServerEvent Log # Message.data is '"+a.data+"', can't be evaluated."),null;a=eval("("+a.data+")");return!a?(g.warn("# ServerEvent Log # Evaluated data is '"+a+"', set to null."),null):a}var j=j||{},g=a.GamecloudLogger.getLogger(j.debug),i=null,c=null,h=1E3,t=this,f={started:"started",closed:"closed",disconnected:"disconnected",connected:"connected"},l={uifocus:{},uiblur:{},gamefocus:{},gameblur:{},gamelaunch:{},queueup:{},login:{},notification:{}},
q={GAME_PROCESS:{channelType:"GAME_PROCESS_NOTIFICATION",channel:null,subscription:null,subscribed:!1,success:function(a){g.info("# ServerEvent Log # Subscribe channel:'"+this.channelType+"' success, following event(s) can be listened:"+a.event.uifocus+", "+a.event.uiblur+", "+a.event.gamefocus+", "+a.event.gameblur)},handle:function(a,b){var c={},d="";switch(b.body.type){case f.started:"server.side.ui"!==b.body.gameId&&"bandwidth.probing"!=b.body.gameId&&(c=l.gamefocus,d="gamefocus");break;case f.closed:"server.side.ui"!==
b.body.gameId&&"bandwidth.probing"!=b.body.gameId&&(c=l.gameblur,d="gameblur");break;case f.disconnected:"server.side.ui"===b.body.gameId&&(c=l.uiblur,d="uiblur");break;case f.connected:"server.side.ui"===b.body.gameId&&(c=l.uifocus,d="uifocus");break;default:g.warn("# ServerEvent Log # Unsupported event status : '"+b.body.type+"'")}for(var e in c)g.debug("# ServerEvent Log # Run listener on event: "+d),c[e].func(b),c[e].disposable&&delete c[e]}},GENERIC:{channelType:"GENERIC_NOTIFICATION",channel:null,
subscription:null,subscribed:!1,success:function(a){g.info("# ServerEvent Log # Subscribe channel:'"+this.channelType+"' success, following event(s) can be listened: "+a.event.login)},handle:function(a,b){var c={},d=null,e="";switch(b.type){case "serverui.activated":c=l.login;d={clientFullJID:b.body.clientFullJID};e="login";break;default:g.warn("# ServerEvent Log # Unsupported event status : '"+b.type+"'")}for(var f in c)g.debug("# ServerEvent Log # Run listener on event: "+e),c[f].func(d),c[f].disposable&&
delete c[f]}},GENERAL:{channelType:"GENERAL_NOTIFICATION",channel:null,subscription:null,subscribed:!1,success:function(a){g.info("# ServerEvent Log # Subscribe channel:'"+this.channelType+"' success, following event(s) can be listened: "+a.event.queueup+", "+a.event.notification)},handle:function(a,b){var c={},d=null,e="";switch(b.body.code){case 601:c=l.queueup;e="queueup";d=-1;b.body.displayText&&(d=b.body.displayText.replace(/\D/gi,""),d=parseInt(d,10));d=isNaN(d)?-1:d;d={code:b.body.code,message:b.body.displayText,
number:d};break;default:c=l.notification,e="notification",d={code:b.body.code,message:b.body.displayText}}for(var f in c)g.debug("# ServerEvent Log # Run listener on event: "+e),c[f].func(d),c[f].disposable&&delete c[f]}}};this.connected=!1;this.protocol="/ugc/cometd";this.event={uifocus:"uifocus",uiblur:"uiblur",gamefocus:"gamefocus",gameblur:"gameblur",gamelaunch:"gamelaunch",queueup:"queueup",login:"login",notification:"notification"};this.onConnect=function(){};this.setUserJid=function(a){i?g.warn("# ServerEvent Log # User JID already set, can't be modified."):
a?(i=a,q.GAME_PROCESS.channel="/"+i+"/GAME_PROCESS_NOTIFICATION",this.connected&&b()):g.warn("# ServerEvent Log # User JID can't be null or empty string.")};this.setUiJid=function(a){c?g.warn("# ServerEvent Log # UI JID already set, can't be modified."):a?(c=a,q.GENERAL.channel="/"+c+"/GENERAL_NOTIFICATION",this.connected&&e()):g.warn("# ServerEvent Log # UI JID can't be null or empty string.")};this.connect=function(){this.connected?g.info("# ServerEvent Log # Service already started."):(g.info("# ServerEvent Log # Start event service."),
g.debug("# ServerEvent Log # Set cometd protocol: "+this.protocol),a.cometd.configure(this.protocol),g.debug("# ServerEvent Log # Try CometD handshake..."),a.cometd.handshake())};this.disconnect=function(){g.info("# ServerEvent Log # Stop event service.");for(var b in l)for(var d in l[b])delete l[b][d];for(b in q)q[b].subscribed&&a.cometd.unsubscribe(q[b].subscription),q[b].subscribed=!1,q[b].channel=null,q[b].subscription=null;a.cometd.removeListener(t.eventListenr.handshake);a.cometd.removeListener(t.eventListenr.subscribe);
a.cometd.disconnect();i=c=null;this.connected=!1};this.addEventListener=function(a,b,c){if(l[a])if(!b||"function"!=typeof b)g.error("# ServerEvent Log # Illegal handler, must be a executable function.");else{var d="listener_"+h++;l[a][d]={func:b,disposable:!0===c?!0:!1};g.info("# ServerEvent Log # Listener on event:"+a+" added, listener id:"+d+".");return d}else g.error("# ServerEvent Log # Event '"+a+"' not supported.")};this.removeEventListener=function(a,b){if(l[a])if(b)if("string"==typeof b)l[a][b]?
delete l[a][b]:g.info("# ServerEvent Log # Listener not exist.");else if("function"==typeof b){for(c in l[a])if(l[a][c].func===b){delete l[a][c];return}g.info("# ServerEvent Log # Listener not exist.")}else g.error("# ServerEvent Log # Illegal handler, must be a executable function or string.");else{g.info("# ServerEvent Log # Remove all listeners in event:"+a);for(var c in l[a])delete l[a][c]}else g.error("# ServerEvent Log # Event '"+a+"' not supported.")};g.info("# ServerEvent Log # Initial event service.");
t.eventListenr={};t.eventListenr.handshake=a.cometd.addListener("/meta/handshake",function(a){if(!0===a.successful){if(g.debug("# ServerEvent Log # CometD handshake succeed!"),t.connected=!0,c&&e(),i&&b(),t.onConnect&&"function"==typeof t.onConnect)t.onConnect()}else g.warn("# ServerEvent Log # Cometd handshake failed!")});t.eventListenr.subscribe=a.cometd.addListener("/meta/subscribe",function(a){if(!0===a.successful){g.debug("# ServerEvent Log # CometD subscribe succeed! subscription:"+a.subscription);
for(var b in q)if(a.subscription===q[b].channel){q[b].subscribed=!0;q[b].success&&q[b].success(t);break}}else g.warn("# ServerEvent Log # CometD subscribe failed! subscription:"+a.subscription)})}})(jQuery);
